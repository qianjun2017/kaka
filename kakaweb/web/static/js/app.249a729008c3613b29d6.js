webpackJsonp([1],{"+1Ij":function(e,t){},"5Lhh":function(e,t){},"6UjR":function(e,t){},GEJr:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("7+uW"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view")],1)],1)},staticRenderFns:[]};var o=a("VU/8")({name:"App"},i,!1,function(e){a("6UjR")},null,null).exports,r=a("/ocq"),l={data:()=>({logining:!1,user:{userName:"",password:""},rules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}),methods:{reset(){this.$refs.loginForm.resetFields()},login(e){this.$refs.loginForm.validate(e=>{if(e){this.logining=!0;let e={userName:this.$util.encrypt(this.user.userName,this.$store.getters.getKey),password:this.$util.encrypt(this.user.password,this.$store.getters.getKey)};this.$ajax.post("/login",e).then(e=>{this.logining=!1,e.success&&(this.$store.commit("login"),Promise.all([this.$ajax.get("/currUser").then(e=>{if(!e.success)return Promise.reject(-1);this.$store.commit("setUser",e.data)}),this.$ajax.get("/currUserPermission").then(e=>{if(!e.success)return Promise.reject(-2);this.$store.commit("setPermissions",e.data)})]).then(e=>{this.$router.push({path:"/admin"})}).catch(function(){this.$store.commit("logout")}))})}})}},created(){this.$ajax.get("/key").then(e=>{if(e.success){let t=this.$util.random(8);this.$ajax.post("/key",{key:this.$util.rsaEncrypt(t,e.data)}).then(e=>{e.success&&this.$store.commit("setKey",t)})}})}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[e._m(0),e._v(" "),a("div",{staticClass:"middle"},[a("div",{staticClass:"login-container"},[e._m(1),e._v(" "),a("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.user,rules:e.rules,"label-position":"left","label-width":"0px"}},[a("el-form-item",{staticClass:"field",attrs:{prop:"userName"}},[a("el-input",{staticClass:"field-input",attrs:{type:"text","auto-complete":"off",placeholder:"用户名"},model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName",t)},expression:"user.userName"}},[a("template",{slot:"prepend"},[a("label",{staticClass:"field-lable"})])],2)],1),e._v(" "),a("el-form-item",{staticClass:"field",attrs:{prop:"password"}},[a("el-input",{staticClass:"field-input",attrs:{type:"password","auto-complete":"off",placeholder:"密  码"},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password",t)},expression:"user.password"}},[a("template",{slot:"prepend"},[a("label",{staticClass:"field-lable password-lable"})])],2)],1),e._v(" "),a("el-form-item",{staticClass:"field submit-field"},[a("el-button",{attrs:{type:"danger",loading:e.logining},nativeOn:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("登    录")])],1)],1),e._v(" "),a("div",{staticClass:"coagent"})],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"top"},[t("img",{staticClass:"logo",attrs:{src:"/static/logo.png"}}),t("b")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-tabs"},[t("div",{staticClass:"login-tab"},[t("div",{staticClass:"login-tab-r"},[this._v("账号登录")])])])}]};var c=a("VU/8")(l,n,!1,function(e){a("GEJr")},null,null).exports,d={data:()=>({sysName:"",sysIcon:"",collapsed:!1,asideWidth:"200px",sysUserAvatar:""}),methods:{handleOpen(e,t){},handleClose(e,t){},handleSelect(e,t){},collapse:function(){this.collapsed=!this.collapsed,this.collapsed?this.asideWidth="60px":this.asideWidth="230px"},logout:function(){this.$confirm("确认退出吗？","提示",{}).then(()=>{this.$ajax.post("/logout").then(e=>{e.success&&(this.$store.commit("logout"),this.$router.push({path:"/login"}))})})},setting:function(){this.$router.push("/system/setting")}},mounted(){this.$ajax.get("/system/config/prefix",{propertyName:"sys"}).then(e=>{e.success?(this.sysName=e.data["sys.name"],this.sysIcon=e.data["sys.icon"],this.sysUserAvatar=e.data["sys.user.avatar"]):this.sysUserAvatar="/static/user.png"})},computed:{userName:function(){return this.$store.getters.getUser.nickName},userAvatar:function(){let e=this.$store.getters.getUser.imageUrl;return null!=e&&""!=e&&void 0!=e||(e=this.sysUserAvatar),e}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"container"},[a("el-header",{staticClass:"header"},[a("div",{staticClass:"logo",class:"logo-width"},[e.sysIcon?a("img",{attrs:{src:e.sysIcon}}):e._e(),e._v(" "),a("span",[e._v(e._s(e.sysName))])]),e._v(" "),a("div",{staticClass:"tools"}),e._v(" "),a("div",{staticClass:"userinfo"},[a("el-dropdown",[a("span",{staticClass:"el-dropdown-link userinfo-inner"},[a("img",{attrs:{src:e.userAvatar}}),e._v(e._s(e.userName))]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.setting",expression:"'system.setting'"}],nativeOn:{click:function(t){return e.setting(t)}}},[e._v("个人设置")]),e._v(" "),a("el-dropdown-item",{attrs:{divided:""},nativeOn:{click:function(t){return e.logout(t)}}},[e._v("退出登录")])],1)],1)],1)]),e._v(" "),a("el-container",{staticClass:"main"},[a("el-aside",{staticClass:"asider",attrs:{width:e.asideWidth}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"$route.path","unique-opened":"",router:"",collapse:e.collapsed},on:{open:e.handleOpen,close:e.handleClose,select:e.handleSelect}},[e._l(e.$router.options.routes,function(t,s){return[t.meta.isMenu?[t.meta.isLeaf?a("el-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:t.meta.permission,expression:"item.meta.permission"}],key:"s"+s,attrs:{index:t.path}},[e._v(e._s(t.meta.title))]):a("el-submenu",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:t.meta.permission,expression:"item.meta.permission"}],key:"s"+s,attrs:{index:t.path}},[a("template",{slot:"title"},[e._v(e._s(t.meta.title))]),e._v(" "),e._l(t.children,function(t,s){return[t.meta.isMenu?a("el-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:t.meta.permission,expression:"child.meta.permission"}],key:"i"+s,attrs:{index:t.path}},[e._v(e._s(t.meta.title))]):e._e()]})],2)]:e._e()]})],2)],1),e._v(" "),a("el-main",{staticClass:"content-container"},[a("el-col",{staticClass:"breadcrumb-container",attrs:{span:24}},[a("strong",{staticClass:"title"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),a("el-col",{staticClass:"content-wrapper",attrs:{span:24}},[a("transition",{attrs:{name:"fade",mode:"out-in"}},[a("div",[a("keep-alive",[e.$route.meta.keepAlive?a("router-view"):e._e()],1),e._v(" "),void 0==e.$route.meta.keepAlive?a("router-view"):e._e()],1)])],1)],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(d,m,!1,function(e){a("u8my")},"data-v-b18fb012",null).exports,p={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",[t("div",{staticClass:"expired"},[t("span",[this._v("您的会话已过期["),t("el-button",{attrs:{type:"text"},on:{click:this.toLogin}},[this._v("重新登录")]),this._v("]")],1)])])},staticRenderFns:[]};var h=a("VU/8")({methods:{toLogin:function(){this.$router.push({path:"/login"})}}},p,!1,function(e){a("NTCn")},"data-v-2e87b350",null).exports,g={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",[t("div",{staticClass:"unauth"},[t("span",[this._v("对不起，您无权访问["),t("el-button",{attrs:{type:"text"},on:{click:this.back}},[this._v("返回")]),this._v("]")],1)])])},staticRenderFns:[]};var v=a("VU/8")({methods:{back:function(){this.$router.go(-1)}}},g,!1,function(e){a("kH9v")},"data-v-6802aacb",null).exports,f={data:()=>({welcome:""}),methods:{},created(){this.$ajax.get("/index").then(e=>{e.success?this.welcome=e.data||"欢迎使用":this.$message.error(e.message)})}},b={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",[t("div",{staticClass:"welcome"},[this._v(this._s(this.welcome))])])},staticRenderFns:[]};var y=a("VU/8")(f,b,!1,function(e){a("dSTW")},"data-v-d3f63ba2",null).exports,_={data:()=>({queryForm:{userName:"",nickName:"",realName:"",phone:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"createTime",order:"desc",message:"",listLoading:!1,editFormVisible:!1,editLoading:!1,editFormRules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"}]},editForm:{id:0,userName:"",password:"",nickName:"",realName:"",phone:"",orgId:""},addFormVisible:!1,addLoading:!1,addFormRules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},addForm:{userName:"",password:"",nickName:"",realName:"",phone:"",orgId:""},authorizeFormVisible:!1,authorizeLoading:!1,authorizeForm:{userId:0,checkedRoles:[],userName:"",isIndeterminate:!0,roles:[],checkAll:!1}}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},getTableData(){var e=this;let t={userName:e.queryForm.userName,nickName:e.queryForm.nickName,phone:e.queryForm.phone,page:e.page,pageSize:e.pageSize,sort:e.sort,order:e.order};e.listLoading=!0,e.$ajax.get("/system/user/page",t).then(t=>{e.listLoading=!1,t.success?(e.page=t.page,e.pageSize=t.pageSize,e.total=t.total,e.pages=t.pages,e.tableData=t.data):(e.tableData=[],e.page=0,e.total=0,e.pages=0,e.message=t.message)})},handleDel:function(e,t){var a=this;a.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{a.listLoading=!0,a.$ajax.post("/system/user/delete/"+t.id).then(e=>{a.listLoading=!1,e.success&&(a.$message({message:"删除成功",type:"success"}),a.getTableData())})}).catch(()=>{})},handleEdit:function(e,t){this.editFormVisible=!0,this.editForm=Object.assign({},t)},handleAdd:function(){this.addFormVisible=!0,this.addForm={userName:"",password:"",nickName:"",realName:"",phone:""}},editSubmit:function(){var e=this;e.$refs.editForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.editLoading=!0;let t=Object.assign({},e.editForm);e.$ajax.post("/system/user/update",t).then(t=>{e.editLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.getTableData())})})})},addSubmit:function(){var e=this;e.$refs.addForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.addLoading=!0;let t=Object.assign({},e.addForm);e.$ajax.post("/system/user/add",t).then(t=>{e.addLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getTableData())})})})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()},authorize:function(e,t){this.authorizeForm.userId=t.id,this.authorizeForm.userName=t.nickName;var a=this;Promise.all([a.$ajax.get("/system/user/"+t.id+"/roles/").then(function(e){return e.success?(a.authorizeForm.checkedRoles=e.data,Promise.resolve(0)):Promise.reject(-1)}),a.$ajax.get("/system/role/all").then(function(e){return e.success?(a.authorizeForm.roles=e.data,Promise.resolve(0)):Promise.reject(-2)})]).then(function(){a.authorizeForm.checkAll=a.authorizeForm.roles.length===a.authorizeForm.checkedRoles.length,a.authorizeForm.isIndeterminate=a.authorizeForm.checkedRoles.length>0&&a.authorizeForm.checkedRoles.length<a.authorizeForm.roles.length,a.authorizeFormVisible=!0},function(e){-2==e?a.$message.info("请先配置系统角色"):a.$message.error("系统错误")})},handleCheckAllChange(e){if(this.authorizeForm.checkedRoles=[],e){var t=this;this.authorizeForm.roles.forEach(e=>{t.authorizeForm.checkedRoles.push(e.id)})}this.authorizeForm.isIndeterminate=!1},handleCheckedRolesChange(e){let t=e.length;this.authorizeForm.checkAll=t===this.authorizeForm.roles.length,this.authorizeForm.isIndeterminate=t>0&&t<this.authorizeForm.roles.length},authorizeSubmit:function(){let e={};e.userId=this.authorizeForm.userId,e.roleList=this.authorizeForm.checkedRoles;var t=this;t.$ajax.post("/system/user/authorize",e).then(function(e){e.success&&(t.$message.success("保存成功"),t.$refs.authorizeForm.resetFields(),t.authorizeFormVisible=!1)})}}},F={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"用户名"},model:{value:e.queryForm.userName,callback:function(t){e.$set(e.queryForm,"userName",t)},expression:"queryForm.userName"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"用户昵称"},model:{value:e.queryForm.nickName,callback:function(t){e.$set(e.queryForm,"nickName",t)},expression:"queryForm.nickName"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"手机号码"},model:{value:e.queryForm.phone,callback:function(t){e.$set(e.queryForm,"phone",t)},expression:"queryForm.phone"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.user.add",expression:"'system.user.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"createTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"用户名"}},[a("span",[e._v(e._s(t.row.userName))])]),e._v(" "),a("el-form-item",{attrs:{label:"昵称"}},[a("span",[e._v(e._s(t.row.nickName))])]),e._v(" "),a("el-form-item",{attrs:{label:"姓名"}},[a("span",[e._v(e._s(t.row.realName))])]),e._v(" "),a("el-form-item",{attrs:{label:"手机号码"}},[a("span",[e._v(e._s(t.row.phone))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"nickName",label:"昵称",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"realName",label:"姓名",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号码",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.user.edit",expression:"'system.user.edit'"}],attrs:{size:"small"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.user.authorize",expression:"'system.user.authorize'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.authorize(t.$index,t.row)}}},[e._v("授权")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.user.delete",expression:"'system.user.delete'"}],attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.userName,callback:function(t){e.$set(e.editForm,"userName",t)},expression:"editForm.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.nickName,callback:function(t){e.$set(e.editForm,"nickName",t)},expression:"editForm.nickName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"realName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.realName,callback:function(t){e.$set(e.editForm,"realName",t)},expression:"editForm.realName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.phone,callback:function(t){e.$set(e.editForm,"phone",t)},expression:"editForm.phone"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.userName,callback:function(t){e.$set(e.addForm,"userName",t)},expression:"addForm.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.nickName,callback:function(t){e.$set(e.addForm,"nickName",t)},expression:"addForm.nickName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"realName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.realName,callback:function(t){e.$set(e.addForm,"realName",t)},expression:"addForm.realName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分配角色",visible:e.authorizeFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.authorizeFormVisible=t}}},[a("el-form",{ref:"authorizeForm",attrs:{model:e.authorizeForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户"}},[a("span",[e._v(e._s(e.authorizeForm.userName))])]),e._v(" "),a("el-form-item",{attrs:{label:"角色"}},[a("el-checkbox",{attrs:{indeterminate:e.authorizeForm.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.authorizeForm.checkAll,callback:function(t){e.$set(e.authorizeForm,"checkAll",t)},expression:"authorizeForm.checkAll"}},[e._v("全选")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedRolesChange},model:{value:e.authorizeForm.checkedRoles,callback:function(t){e.$set(e.authorizeForm,"checkedRoles",t)},expression:"authorizeForm.checkedRoles"}},e._l(e.authorizeForm.roles,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.roleName))])}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.authorizeFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.authorizeLoading},nativeOn:{click:function(t){return e.authorizeSubmit(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var w=a("VU/8")(_,F,!1,function(e){a("zNWp")},"data-v-688fb978",null).exports,k={data:()=>({filterText:"",queryForm:{authName:""},treeData:[],checkedNodeData:null,defaultProps:{label:"authName",children:"subAuthList"},editFormVisible:!1,editLoading:!1,editFormRules:{authName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],authCode:[{required:!0,message:"请输入权限编码",trigger:"blur"}],authType:[{required:!0,message:"请输入权限类型",trigger:"blur"}]},editForm:{id:0,authName:"",authCode:"",authType:"",parentId:null},addFormVisible:!1,addLoading:!1,addFormRules:{authName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],authCode:[{required:!0,message:"请输入权限编码",trigger:"blur"}],authType:[{required:!0,message:"请输入权限类型",trigger:"blur"}]},addForm:{authName:"",authCode:"",authType:"",parentId:null},detailFormVisible:!1,detailForm:{}}),methods:{filterNode:(e,t)=>!e||(-1===t.id||-1!==t.authName.indexOf(e)),checkNode(e,t){this.checkedNodeData=e},getTreeData(){var e=this;e.$ajax.get("/system/auth/tree").then(t=>{e.treeData=[],t.success?e.treeData.push(t.root):e.treeData.push({id:-1,authName:"权限树",subAuthList:[]})})},handleDel:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$confirm("确认删除权限【"+e.checkedNodeData.authName+"】吗？","提示",{}).then(function(){e.$ajax.post("/system/auth/delete/"+e.checkedNodeData.id).then(function(t){t.success&&(e.$message.success("删除成功"),e.checkedNodeData=null,e.getTreeData())})}):e.$message.info("【权限树】节点不能删除"):e.$message.info("请选择要删除的权限节点")},handleEdit:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$ajax.get("/system/auth/get/"+e.checkedNodeData.id).then(function(t){t.success&&(e.editForm=t.data,e.checkedNodeData=null,e.editFormVisible=!0)}):e.$message.info("【权限树】节点不能编辑"):e.$message.info("请选择要编辑的权限节点")},handleAdd:function(){null!=this.checkedNodeData?(this.addForm={authName:"",authCode:"",authType:"",parentId:null},-1!==this.checkedNodeData.id&&(this.addForm.parentId=this.checkedNodeData.id),this.checkedNodeData=null,this.addFormVisible=!0):this.$message.info("请选择父权限节点")},handleDetail:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$ajax.get("/system/auth/get/"+e.checkedNodeData.id).then(function(t){t.success&&(e.detailForm=t.data,e.checkedNodeData=null,e.detailFormVisible=!0)}):e.$message.info("【权限树】节点无详情"):e.$message.info("请选择权限节点")},editSubmit:function(){var e=this;e.$refs.editForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.editLoading=!0;let t=Object.assign({},e.editForm);e.$ajax.post("/system/auth/update",t).then(t=>{e.editLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.getTreeData())})})})},addSubmit:function(){var e=this;e.$refs.addForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.addLoading=!0;let t=Object.assign({},e.addForm);e.$ajax.post("/system/auth/add",t).then(t=>{e.addLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getTreeData())})})})}},mounted(){this.getTreeData()},watch:{filterText(e){this.$refs.tree.filter(e)}}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"输入权限名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.auth.detail",expression:"'system.auth.detail'"}],attrs:{disabled:null===this.checkedNodeData},on:{click:e.handleDetail}},[e._v("详情")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.auth.add",expression:"'system.auth.add'"}],attrs:{type:"primary",disabled:null===this.checkedNodeData},on:{click:e.handleAdd}},[e._v("新增")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.auth.update",expression:"'system.auth.update'"}],attrs:{type:"warning",disabled:null===this.checkedNodeData},on:{click:e.handleEdit}},[e._v("修改")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.auth.delete",expression:"'system.auth.delete'"}],attrs:{type:"danger",disabled:null===this.checkedNodeData},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":"id","auto-expand-parent":"","filter-node-method":e.filterNode,"default-expanded-keys":[-1],accordion:""},on:{"node-click":e.checkNode}})],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"权限名称",prop:"authName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.authName,callback:function(t){e.$set(e.editForm,"authName",t)},expression:"editForm.authName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"权限编码",prop:"authCode"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.authCode,callback:function(t){e.$set(e.editForm,"authCode",t)},expression:"editForm.authCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"权限类型",prop:"authType"}},[a("el-radio-group",{model:{value:e.editForm.authType,callback:function(t){e.$set(e.editForm,"authType",t)},expression:"editForm.authType"}},[a("el-radio",{attrs:{label:"menu"}},[e._v("菜单权限")]),e._v(" "),a("el-radio",{attrs:{label:"oper"}},[e._v("功能权限")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"权限名称",prop:"authName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.authName,callback:function(t){e.$set(e.addForm,"authName",t)},expression:"addForm.authName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"权限编码",prop:"authCode"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.authCode,callback:function(t){e.$set(e.addForm,"authCode",t)},expression:"addForm.authCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"权限类型",prop:"authType"}},[a("el-radio-group",{model:{value:e.addForm.authType,callback:function(t){e.$set(e.addForm,"authType",t)},expression:"addForm.authType"}},[a("el-radio",{attrs:{label:"menu"}},[e._v("菜单权限")]),e._v(" "),a("el-radio",{attrs:{label:"oper"}},[e._v("功能权限")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"详情",visible:e.detailFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.detailFormVisible=t}}},[a("el-form",{ref:"detailForm",attrs:{model:e.detailForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"权限名称"}},[a("span",[e._v(e._s(e.detailForm.authName))])]),e._v(" "),a("el-form-item",{attrs:{label:"权限编码"}},[a("span",[e._v(e._s(e.detailForm.authCode))])]),e._v(" "),a("el-form-item",{attrs:{label:"权限类型"}},[a("span",[e._v(e._s(e.detailForm.authTypeName))])]),e._v(" "),a("el-form-item",{attrs:{label:"权限层级"}},[a("span",[e._v(e._s(e.detailForm.level))])]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[e._v(e._s(e.detailForm.createTime))])])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.detailFormVisible=!1}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var $=a("VU/8")(k,x,!1,function(e){a("gCNA")},"data-v-cf9c99da",null).exports,N={data:()=>({queryForm:{roleName:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"createTime",order:"desc",message:"",listLoading:!1,sels:[],editFormVisible:!1,editLoading:!1,editFormRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},editForm:{id:0,roleName:""},addFormVisible:!1,addLoading:!1,addFormRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},addForm:{roleName:""},authorizeFormVisible:!1,authorizeLoading:!1,authorizeForm:{roleId:0,checkedAuths:[],roleName:"",auths:[],defaultProps:{label:"authName",children:"subAuthList"}}}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},getTableData(){var e=this;let t={roleName:e.queryForm.roleName,page:e.page,pageSize:e.pageSize,sort:e.sort,order:e.order};e.listLoading=!0,e.$ajax.get("/system/role/page",t).then(t=>{e.listLoading=!1,t.success?(e.page=t.page,e.pageSize=t.pageSize,e.total=t.total,e.pages=t.pages,e.tableData=t.data):(e.tableData=[],e.page=0,e.total=0,e.pages=0,e.message=t.message)})},handleDel:function(e,t){var a=this;a.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{a.listLoading=!0,a.$ajax.post("/system/role/delete/"+t.id).then(e=>{a.listLoading=!1,e.success&&(a.$message({message:"删除成功",type:"success"}),a.getTableData())})}).catch(()=>{})},handleEdit:function(e,t){this.editFormVisible=!0,this.editForm=Object.assign({},t)},handleAdd:function(){this.addFormVisible=!0,this.addForm={roleName:""}},editSubmit:function(){var e=this;e.$refs.editForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.editLoading=!0;let t=Object.assign({},e.editForm);e.$ajax.post("/system/role/update",t).then(t=>{e.editLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.getTableData())})})})},addSubmit:function(){var e=this;e.$refs.addForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.addLoading=!0;let t=Object.assign({},e.addForm);e.$ajax.post("/system/role/add",t).then(t=>{e.addLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getTableData())})})})},selsChange:function(e){this.sels=e},batchRemove:function(){var e=this,t=e.sels.map(e=>e.id).toString();e.$confirm("确认删除选中记录吗？","提示",{type:"warning"}).then(()=>{e.listLoading=!0;let a={ids:t};e.$ajax.post("/system/role/delete/batch",a).then(t=>{e.listLoading=!1,t.success&&(e.$message({message:"删除成功",type:"success"}),e.getTableData())})}).catch(()=>{})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()},authorize:function(e,t){this.authorizeForm.roleId=t.id,this.authorizeForm.roleName=t.roleName;var a=this;Promise.all([a.$ajax.get("/system/role/"+t.id+"/auths/").then(function(e){return e.success?(a.authorizeForm.checkedAuths=e.data,Promise.resolve(0)):Promise.reject(-1)}),a.$ajax.get("/system/auth/tree").then(function(e){return a.authorizeForm.auths=[],e.success?(a.authorizeForm.auths.push(e.root),Promise.resolve(0)):Promise.reject(-2)})]).then(function(){a.authorizeFormVisible=!0},function(e){-2==e?a.$message.info("请先配置系统权限"):a.$message.error("系统错误")})},checkChange:function(){this.authorizeForm.checkedAuths=this.$refs.tree.getCheckedKeys()},authorizeSubmit:function(){let e={};e.roleId=this.authorizeForm.roleId,e.authList=this.authorizeForm.checkedAuths;var t=this;t.$ajax.post("/system/role/authorize",e).then(function(e){e.success&&(t.$message.success("保存成功"),t.$refs.authorizeForm.resetFields(),t.authorizeFormVisible=!1)})}}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.queryForm.roleName,callback:function(t){e.$set(e.queryForm,"roleName",t)},expression:"queryForm.roleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.role.add",expression:"'system.role.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"createTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged,"selection-change":e.selsChange}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roleName",label:"角色名称",width:"240"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"250",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.role.edit",expression:"'system.role.edit'"}],attrs:{size:"small"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.role.authorize",expression:"'system.role.authorize'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.authorize(t.$index,t.row)}}},[e._v("授权")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.role.delete",expression:"'system.role.delete'"}],attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.role.delete",expression:"'system.role.delete'"}],attrs:{type:"danger",disabled:0===this.sels.length},on:{click:e.batchRemove}},[e._v("批量删除")]),e._v(" "),a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.roleName,callback:function(t){e.$set(e.editForm,"roleName",t)},expression:"editForm.roleName"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.roleName,callback:function(t){e.$set(e.addForm,"roleName",t)},expression:"addForm.roleName"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分配权限",visible:e.authorizeFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.authorizeFormVisible=t}}},[a("el-form",{ref:"authorizeForm",attrs:{model:e.authorizeForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"角色"}},[a("span",[e._v(e._s(e.authorizeForm.roleName))])]),e._v(" "),a("el-form-item",{attrs:{label:"权限"}},[a("el-tree",{ref:"tree",attrs:{"show-checkbox":"",data:e.authorizeForm.auths,props:e.authorizeForm.defaultProps,"node-key":"id","auto-expand-parent":"","default-expanded-keys":[-1],"default-checked-keys":e.authorizeForm.checkedAuths,accordion:"","check-strictly":""},on:{"check-change":e.checkChange}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.authorizeFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.authorizeLoading},nativeOn:{click:function(t){return e.authorizeSubmit(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var C=a("VU/8")(N,L,!1,function(e){a("+1Ij")},"data-v-0710d89f",null).exports,D={data:()=>({filterText:"",queryForm:{locationName:""},treeData:[],checkedNodeData:null,defaultProps:{label:"locationName",children:"subLocationList"},editFormVisible:!1,editLoading:!1,editFormRules:{locationName:[{required:!0,message:"请输入地区名称",trigger:"blur"}],locationCode:[{required:!0,message:"请输入地区编码",trigger:"blur"}]},editForm:{id:0,locationName:"",locationCode:"",parentId:null},addFormVisible:!1,addLoading:!1,addFormRules:{locationName:[{required:!0,message:"请输入地区名称",trigger:"blur"}],locationCode:[{required:!0,message:"请输入地区编码",trigger:"blur"}]},addForm:{locationName:"",locationCode:"",parentId:null},detailFormVisible:!1,detailForm:{}}),methods:{filterNode:(e,t)=>!e||(-1===t.id||-1!==t.locationName.indexOf(e)),checkNode(e,t){this.checkedNodeData=e},getTreeData(){var e=this;e.$ajax.get("/system/location/tree").then(t=>{e.treeData=[],t.success?e.treeData.push(t.root):e.treeData.push({id:-1,locationName:"地区树",subLocationList:[]})})},handleDel:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$confirm("确认删除地区【"+e.checkedNodeData.locationName+"】吗？","提示",{}).then(function(){e.$ajax.post("/system/location/delete/"+e.checkedNodeData.id).then(function(t){t.success&&(e.$message.success("删除成功"),e.checkedNodeData=null,e.getTreeData())})}):e.$message.info("【地区树】节点不能删除"):e.$message.info("请选择要删除的地区节点")},handleEdit:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$ajax.get("/system/location/get/"+e.checkedNodeData.id).then(function(t){t.success&&(e.editForm=t.data,e.checkedNodeData=null,e.editFormVisible=!0)}):e.$message.info("【地区树】节点不能编辑"):e.$message.info("请选择要编辑的地区节点")},handleAdd:function(){null!=this.checkedNodeData?(this.addForm={locationName:"",locationCode:"",parentId:null},-1!==this.checkedNodeData.id&&(this.addForm.parentId=this.checkedNodeData.id),this.checkedNodeData=null,this.addFormVisible=!0):this.$message.info("请选择父地区节点")},handleDetail:function(){var e=this;null!=e.checkedNodeData?-1!==e.checkedNodeData.id?e.$ajax.get("/system/location/get/"+e.checkedNodeData.id).then(function(t){t.success&&(e.detailForm=t.data,e.checkedNodeData=null,e.detailFormVisible=!0)}):e.$message.info("【地区树】节点无详情"):e.$message.info("请选择地区节点")},editSubmit:function(){var e=this;e.$refs.editForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.editLoading=!0;let t=Object.assign({},e.editForm);e.$ajax.post("/system/location/update",t).then(t=>{e.editLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.getTreeData())})})})},addSubmit:function(){var e=this;e.$refs.addForm.validate(t=>{t&&e.$confirm("确认提交吗？","提示",{}).then(()=>{e.addLoading=!0;let t=Object.assign({},e.addForm);e.$ajax.post("/system/location/add",t).then(t=>{e.addLoading=!1,t.success&&(e.$message({message:"提交成功",type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getTreeData())})})})}},mounted(){this.getTreeData()},watch:{filterText(e){this.$refs.tree.filter(e)}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"输入地区名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.location.detail",expression:"'system.location.detail'"}],attrs:{disabled:null===this.checkedNodeData},on:{click:e.handleDetail}},[e._v("详情")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.location.add",expression:"'system.location.add'"}],attrs:{type:"primary",disabled:null===this.checkedNodeData},on:{click:e.handleAdd}},[e._v("新增")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.location.update",expression:"'system.location.update'"}],attrs:{type:"warning",disabled:null===this.checkedNodeData},on:{click:e.handleEdit}},[e._v("修改")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.location.delete",expression:"'system.location.delete'"}],attrs:{type:"danger",disabled:null===this.checkedNodeData},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":"id","auto-expand-parent":"","filter-node-method":e.filterNode,"default-expanded-keys":[-1],accordion:""},on:{"node-click":e.checkNode}})],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"地区名称",prop:"locationName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.locationName,callback:function(t){e.$set(e.editForm,"locationName",t)},expression:"editForm.locationName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地区编码",prop:"locationCode"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.locationCode,callback:function(t){e.$set(e.editForm,"locationCode",t)},expression:"editForm.locationCode"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"地区名称",prop:"locationName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.locationName,callback:function(t){e.$set(e.addForm,"locationName",t)},expression:"addForm.locationName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地区编码",prop:"locationCode"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.locationCode,callback:function(t){e.$set(e.addForm,"locationCode",t)},expression:"addForm.locationCode"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"详情",visible:e.detailFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.detailFormVisible=t}}},[a("el-form",{ref:"detailForm",attrs:{model:e.detailForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"地区名称"}},[a("span",[e._v(e._s(e.detailForm.locationName))])]),e._v(" "),a("el-form-item",{attrs:{label:"地区编码"}},[a("span",[e._v(e._s(e.detailForm.locationCode))])]),e._v(" "),a("el-form-item",{attrs:{label:"地区层级"}},[a("span",[e._v(e._s(e.detailForm.level))])]),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[e._v(e._s(e.detailForm.createTime))])])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.detailFormVisible=!1}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var z=a("VU/8")(D,S,!1,function(e){a("UOVS")},"data-v-dd8df646",null).exports,P={data:()=>({queryForm:{userName:"",module:"",operType:"",modules:{},operTypes:{}},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"operateTime",order:"desc",message:"",listLoading:!1,detailFormVisible:!1,detailLoading:!1,detailForm:[]}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},getTableData(){var e=this;let t={userName:e.queryForm.userName,module:e.queryForm.module,operType:e.queryForm.operType,page:e.page,pageSize:e.pageSize,sort:e.sort,order:e.order};e.listLoading=!0,e.$ajax.get("/system/log/page",t).then(t=>{e.listLoading=!1,t.success?(e.page=t.page,e.pageSize=t.pageSize,e.total=t.total,e.pages=t.pages,e.tableData=t.data):(e.tableData=[],e.page=0,e.total=0,e.pages=0,e.message=t.message)})},handleDetail:function(e,t){var a=this;a.$ajax.get("/system/log/get/"+t.id).then(function(e){e.success?(a.detailForm=e.data,a.detailFormVisible=!0):a.$message.error(e.message)})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()}},created(){var e=this;e.$ajax.get("/system/log/module").then(function(t){t.success&&(e.queryForm.modules=t.data)}),e.$ajax.get("/system/log/operType").then(function(t){t.success&&(e.queryForm.operTypes=t.data)})}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"操作人姓名"},model:{value:e.queryForm.userName,callback:function(t){e.$set(e.queryForm,"userName",t)},expression:"queryForm.userName"}})],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择模块",clearable:""},model:{value:e.queryForm.module,callback:function(t){e.$set(e.queryForm,"module",t)},expression:"queryForm.module"}},e._l(e.queryForm.modules,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}))],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择操作类型",clearable:""},model:{value:e.queryForm.operType,callback:function(t){e.$set(e.queryForm,"operType",t)},expression:"queryForm.operType"}},e._l(e.queryForm.operTypes,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"operateTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{prop:"userName",label:"操作人",width:"100","show-overflow-tooltip":"",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"module",label:"操作模块",width:"120","show-overflow-tooltip":"",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operType",label:"操作类型",width:"120","show-overflow-tooltip":"",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"操作简介",width:"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"operateTime",label:"操作时间",width:"250",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.log.detail",expression:"'system.log.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"详情",visible:e.detailFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.detailFormVisible=t}}},[a("el-form",{ref:"detailForm",attrs:{model:e.detailForm,"label-width":"80px","label-position":"left"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作人"}},[a("span",[e._v(e._s(e.detailForm.userName))])])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作IP"}},[a("span",[e._v(e._s(e.detailForm.clientIp))])])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作模块"}},[a("span",[e._v(e._s(e.queryForm.modules[e.detailForm.module]||"未知模块"))])])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作类型"}},[a("span",[e._v(e._s(e.queryForm.operTypes[e.detailForm.operType]||"未知类型"))])])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作简介"}},[a("span",[e._v(e._s(e.detailForm.title))])])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"操作耗时"}},[a("span",[e._v(e._s(e.detailForm.time)+"ms")])])],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"操作结果"}},[a("span",[e._v(e._s(e.detailForm.result))])])],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"操作参数"}},[a("div",{staticClass:"wrap"},[e._v(e._s(e.detailForm.params))])])],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"操作内容"}},[a("div",{staticClass:"wrap"},[e._v(e._s(e.detailForm.content))])])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.detailFormVisible=!1}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var T=a("VU/8")(P,q,!1,function(e){a("5Lhh")},"data-v-06cc55a9",null).exports,V={data:()=>({user:{userName:"",nickName:"",phone:"",realName:"",imageUrl:""},service:"",pwdFormRules:{oldpwd:[{required:!0,message:"请输入原密码",trigger:"blur"}],newpwd:[{required:!0,message:"请输入新密码",trigger:"blur"}],secondpwd:[{required:!0,message:"请确认密码",trigger:"blur"}]},pwdForm:{newpwd:"",oldpwd:"",secondpwd:""},pwdFormVisible:!1,pwdLoading:!1,phoneFormRules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"}]},phoneForm:{phone:""},phoneFormVisible:!1,phoneLoading:!1,title:"绑定手机",realNameFormRules:{realName:[{required:!0,message:"请输入姓名",trigger:"blur"}]},realNameForm:{realName:""},realNameFormVisible:!1,realNameLoading:!1,nickNameFormRules:{nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}]},nickNameForm:{nickName:""},nickNameFormVisible:!1,nickNameLoading:!1}),methods:{handleAddSuccess:function(e,t,a){e.success&&this.submitSetting({imageUrl:this.service+e.data[0]})},submitSetting:function(e){let t=Object.assign({},e);return t.id=this.user.id,this.$ajax.post("/system/user/setting/save",t).then(t=>{if(t.success){this.$message.success("保存成功");let t=this.$store.getters.getUser;for(let a in e)t[a]=e[a],this.user[a]=e[a];return this.$store.commit("setUser",t),Promise.resolve(1)}return Promise.reject(0)})},pwdSubmit:function(){this.$refs.pwdForm.validate(e=>{e&&this.$confirm("确认修改密码吗？","提示",{}).then(()=>{this.pwdLoading=!0,this.submitSetting({password:this.pwdForm.newpwd}).then(e=>{this.pwdLoading=!1,this.pwdFormVisible=!1})})})},handleModifyPassword:function(){this.pwdFormVisible=!0},handlePhone:function(){void 0==this.user.phone||null==this.user.phone||""==this.user.phone?this.title="绑定手机":(this.title="更换手机",this.phoneForm.phone=this.user.phone),this.phoneFormVisible=!0},phoneSubmit:function(){this.$refs.phoneForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.phoneLoading=!0,this.submitSetting({phone:this.phoneForm.phone}).then(e=>{this.phoneLoading=!1,this.phoneFormVisible=!1})})})},handleRealName:function(){this.realNameForm.realName=this.user.realName,this.realNameFormVisible=!0},realNameSubmit:function(){this.$refs.realNameForm.validate(e=>{e&&this.$confirm("确认实名吗？","提示",{}).then(()=>{this.realNameLoading=!0,this.submitSetting({realName:this.realNameForm.realName}).then(e=>{this.realNameLoading=!1,this.realNameFormVisible=!1})})})},handleNickName:function(){this.nickNameForm.nickName=this.user.nickName,this.nickNameFormVisible=!0},nickNameSubmit:function(){this.$refs.nickNameForm.validate(e=>{e&&this.$confirm("确认修改昵称吗？","提示",{}).then(()=>{this.nickNameLoading=!0,this.submitSetting({nickName:this.nickNameForm.nickName}).then(e=>{this.nickNameLoading=!1,this.nickNameFormVisible=!1})})})}},mounted(){this.service=this.$imageService,this.user=this.$store.getters.getUser,""!=this.user.imageUrl&&null!=this.user.imageUrl&&void 0!=this.user.imageUrl||this.$ajax.get("/system/config/value",{propertyName:"sys.user.avatar"}).then(e=>{e.success?this.user.imageUrl=e.data:this.user.imageUrl="/static/user.png"})},computed:{action:function(){return this.service+"/file/up"}}},U={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{staticClass:"setting-box"},[a("div",{staticClass:"avatar-box"},[a("el-upload",{attrs:{"list-type":"avatar-uploader",action:e.action,"show-file-list":!1,"on-success":e.handleAddSuccess,data:{type:"image",size:"150"}}},[e.user.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.user.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("div",{staticClass:"form-box"},[a("el-row",[a("span",{staticClass:"lable"},[e._v("用户名:")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(e.user.userName))]),e._v(" "),a("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:e.handleModifyPassword}},[e._v("修改密码")])],1),e._v(" "),a("el-row",[a("span",{staticClass:"lable"},[e._v("昵称:")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(e.user.nickName))]),e._v(" "),a("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:e.handleNickName}},[e._v("修改")])],1),e._v(" "),a("el-row",[a("span",{staticClass:"lable"},[e._v("姓名:")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(e.user.realName))]),e._v(" "),void 0==e.user.realName||null==e.user.realName||""==e.user.realName?a("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:e.handleRealName}},[e._v("去实名")]):e._e()],1),e._v(" "),a("el-row",[a("span",{staticClass:"lable"},[e._v("手机号:")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(e.user.phone))]),e._v(" "),void 0==e.user.phone||null==e.user.phone||""==e.user.phone?a("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:e.handlePhone}},[e._v("绑定手机")]):a("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:e.handlePhone}},[e._v("更换手机")])],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"修改密码",visible:e.pwdFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.pwdFormVisible=t}}},[a("el-form",{ref:"pwdForm",attrs:{model:e.pwdForm,"label-width":"80px",rules:e.pwdFormRules}},[a("el-form-item",{attrs:{label:"原密码",prop:"oldpwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.pwdForm.oldpwd,callback:function(t){e.$set(e.pwdForm,"oldpwd",t)},expression:"pwdForm.oldpwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"newpwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.pwdForm.newpwd,callback:function(t){e.$set(e.pwdForm,"newpwd",t)},expression:"pwdForm.newpwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"secondpwd"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.pwdForm.secondpwd,callback:function(t){e.$set(e.pwdForm,"secondpwd",t)},expression:"pwdForm.secondpwd"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.pwdFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.pwdLoading},nativeOn:{click:function(t){return e.pwdSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.phoneFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.phoneFormVisible=t}}},[a("el-form",{ref:"phoneForm",attrs:{model:e.phoneForm,"label-width":"80px",rules:e.phoneFormRules}},[a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.phoneForm.phone,callback:function(t){e.$set(e.phoneForm,"phone",t)},expression:"phoneForm.phone"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.phoneFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.phoneLoading},nativeOn:{click:function(t){return e.phoneSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"实名",visible:e.realNameFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.realNameFormVisible=t}}},[a("el-form",{ref:"realNameForm",attrs:{model:e.realNameForm,"label-width":"80px",rules:e.realNameFormRules}},[a("el-form-item",{attrs:{label:"姓名",prop:"realName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.realNameForm.realName,callback:function(t){e.$set(e.realNameForm,"realName",t)},expression:"realNameForm.realName"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.realNameFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.realNameLoading},nativeOn:{click:function(t){return e.realNameSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改昵称",visible:e.nickNameFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.nickNameFormVisible=t}}},[a("el-form",{ref:"nickNameForm",attrs:{model:e.nickNameForm,"label-width":"80px",rules:e.nickNameFormRules}},[a("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.nickNameForm.nickName,callback:function(t){e.$set(e.nickNameForm,"nickName",t)},expression:"nickNameForm.nickName"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.nickNameFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.nickNameLoading},nativeOn:{click:function(t){return e.nickNameSubmit(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var j=a("VU/8")(V,U,!1,function(e){a("vPRW")},"data-v-be30ffd8",null).exports,I={data:()=>({queryForm:{name:"",status:""},statuss:{draft:"未上架",on:"上架中",down:"已下架"},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"createTime",order:"desc",message:"",listLoading:!1,dialogVisible:!1,dialogImageUrl:"",show:"list",submitLoading:!1,editor:void 0,carouselFormRules:{name:[{required:!0,message:"请输入轮播图名称",trigger:"blur"}]},carouselForm:{name:"",imageUrl:"",plot:""},fileList:[],imageUrlList:[],service:""}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},handlePicture:function(e){this.dialogImageUrl=e,this.dialogVisible=!0},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getTableData(){let e={name:this.queryForm.name,status:this.queryForm.status,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/carousel/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleDel:function(e,t){this.$confirm("确认删除该轮播图吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/carousel/delete/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message({message:"删除成功",type:"success"}),this.getTableData())})}).catch(()=>{})},handleEdit:function(e,t){this.imageUrlList=[],this.$ajax.get("/carousel/get/"+t.id).then(e=>{if(e.success){if(this.carouselForm=Object.assign({},e.data),this.show="update",this.fileList=[],this.fileList.push({url:e.data.imageUrl}),void 0==this.editor){var t=this,a=window.wangEditor;this.editor=new a("#description"),this.editor.customConfig.uploadImgServer=this.action,this.editor.customConfig.uploadImgMaxSize=10485760,this.editor.customConfig.uploadFileName="file",this.editor.customConfig.uploadImgHooks={customInsert:function(e,a,s){if(a.success){(a.data||[]).forEach(function(a){e(t.service+a)})}}},this.editor.create()}void 0==this.carouselForm.plot&&""==this.carouselForm.plot||this.editor.txt.html(this.carouselForm.plot)}})},handleUp:function(e,t){this.listLoading=!0,this.$ajax.post("/carousel/up/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message.success("上架成功"),this.getTableData())})},handleDown:function(e,t){this.listLoading=!0,this.$ajax.post("/carousel/down/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message.success("下架成功"),this.getTableData())})},handleAdd:function(){if(this.carouselForm={name:"",imageUrl:"",plot:""},this.fileList=[],this.imageUrlList=[],this.show="add",void 0==this.editor){var e=this,t=window.wangEditor;this.editor=new t("#description"),this.editor.customConfig.uploadImgServer=this.action,this.editor.customConfig.uploadImgMaxSize=10485760,this.editor.customConfig.uploadFileName="file",this.editor.customConfig.uploadImgHooks={customInsert:function(t,a,s){if(a.success){(a.data||[]).forEach(function(a){t(e.service+a)})}}},this.editor.create()}},sortChanged:function(e){this.sort=null!=e.prop?e.prop.replace("Name",""):"",this.order="ascending"===e.order?"asc":"desc",this.getTableData()},handleSuccess:function(e,t,a){e.success&&(this.imageUrlList=[],a.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])}))},handleRemove:function(e,t){this.imageUrlList=[],t.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])})},handleSubmit:function(){this.imageUrlList.length>0&&(this.carouselForm.imageUrl=this.imageUrlList[0]),this.editor&&(this.carouselForm.plot=this.editor.txt.html()),this.$refs.carouselForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.submitLoading=!0;let e=Object.assign({},this.carouselForm);this.$ajax.post("/carousel/"+this.show,e).then(e=>{this.submitLoading=!1,e.success&&(this.$message({message:"提交成功",type:"success"}),this.show="list",this.getTableData())})})})},back:function(){this.show="list"}},mounted(){this.service=this.$imageService},computed:{action:function(){return this.service+"/file/up"}}},R={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{directives:[{name:"show",rawName:"v-show",value:"list"==e.show,expression:"show=='list'"}]},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"轮播图名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择轮播图状态",clearable:""},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.statuss,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"carousel.add",expression:"'carousel.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"createTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{prop:"name",label:"轮播图名称",width:"200","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"imageUrl",label:"轮播图片",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.row.imageUrl,expression:"scope.row.imageUrl"}],staticClass:"img",attrs:{width:"40",height:"40"},on:{click:function(a){e.handlePicture(t.row.imageUrl)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"statusName",label:"轮播图状态",width:"120",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"发布时间",width:"200",sortable:"custom","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"carousel.update",expression:"'carousel.update'"}],attrs:{size:"small"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),"draft"==t.row.status?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"carousel.up",expression:"'carousel.up'"}],attrs:{type:"primary",size:"small"},on:{click:function(a){e.handleUp(t.$index,t.row)}}},[e._v("上架")]):e._e(),e._v(" "),"draft"==t.row.status||"down"==t.row.status?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"carousel.delete",expression:"'carousel.delete'"}],attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[e._v("删除")]):e._e(),e._v(" "),"on"==t.row.status?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"carousel.down",expression:"'carousel.down'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.handleDown(t.$index,t.row)}}},[e._v("下架")]):e._e()]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"add"==e.show||"update"==e.show,expression:"show=='add' || show=='update'"}]},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"carouselForm",attrs:{model:e.carouselForm,"label-width":"100px",rules:e.carouselFormRules}},[a("el-form-item",{attrs:{label:"轮播图片",required:""}},[a("el-upload",{attrs:{"list-type":"picture-card",action:e.action,"on-preview":e.handlePictureCardPreview,"file-list":e.fileList,"on-success":e.handleSuccess,"on-remove":e.handleRemove,data:{type:"image"},limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"轮播图名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.carouselForm.name,callback:function(t){e.$set(e.carouselForm,"name",t)},expression:"carouselForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"轮播详情"}},[a("div",{attrs:{id:"description"}})])],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl}})])],1)},staticRenderFns:[]};var E=a("VU/8")(I,R,!1,function(e){a("azMP")},"data-v-1c7ca5b5",null).exports,O={data:()=>({queryForm:{name:"",phone:"",cardLevel:"",cardNo:""},tableData:[],statuss:{normal:"正常",locked:"锁定"},total:0,pages:0,page:1,pageSize:8,sort:"createTime",order:"desc",message:"",listLoading:!1,view:"list",more:!1,icon:"el-icon-arrow-down",customer:{},levelData:[],pointsTableData:[],pointsTotal:0,pointsPages:0,pointsPage:1,pointsPageSize:8,pointsMessage:"",pointsFormVisible:!1,pointsLoading:!1,pointsForm:{points:""},pointsFormRules:{points:[{required:!0,message:"请输入调整积分数",trigger:"blur"}],remark:[{required:!0,message:"请输入调整积分原因",trigger:"blur"}]}}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},searchMore:function(){this.more=!this.more,this.more?this.icon="el-icon-arrow-up":this.icon="el-icon-arrow-down"},getTableData(){let e={name:this.queryForm.name,phone:this.queryForm.phone,cardLevel:this.queryForm.cardLevel,cardNo:this.queryForm.cardNo,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/customer/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleLock:function(e,t){this.$confirm("确认锁定会员【"+t.nickName+"】吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/customer/lock/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message({message:"已锁定",type:"success"}),this.getTableData())})}).catch(()=>{})},handleUnlock:function(e,t){this.$confirm("确认解锁会员【"+t.nickName+"】吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/customer/unlock/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message({message:"解锁成功",type:"success"}),this.getTableData())})}).catch(()=>{})},handleDetail:function(e,t){this.$ajax.get("/customer/get/"+t.id).then(e=>{e.success?(this.customer=e.data,this.view="detail"):this.$message.error(e.message)})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()},back:function(){this.view="list"},getLevelData:function(){this.$ajax.get("/card/levels").then(e=>{e.success?this.levelData=e.data:this.levelData=[]})},getPointsTableData:function(){let e={customerId:this.customer.id,page:this.pointsPage,pageSize:this.pointsPageSize,sort:"createTime",order:"desc"};this.$ajax.get("/customer/points/page",e).then(e=>{e.success?(this.pointsPage=e.page,this.pointsPageSize=e.pageSize,this.pointsTotal=e.total,this.pointsPages=e.pages,this.pointsTableData=e.data):(this.pointsTableData=[],this.pointsPage=0,this.pointsTotal=0,this.pointsPages=0,this.pointsMessage=e.message)})},handlePointsHistory:function(e,t){this.pointsPage=1,this.customer.id=t.id,this.getPointsTableData(),this.view="history"},handlePoints:function(e,t){this.pointsForm.customerId=t.id,this.pointsFormVisible=!0},submitPoints:function(){this.$refs.pointsForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.pointsLoading=!0,this.$ajax.post("/customer/points",this.pointsForm).then(e=>{this.pointsLoading=!1,e.success?(this.$message.success("提交成功"),this.pointsFormVisible=!1,this.getTableData()):this.$message.error(e.message)})})})},handleCurrentPointsChange(e){this.pointsPage=e,this.getPointsTableData()}},created(){this.getLevelData()},computed:{time:function(){if(this.customer.createTime){var e=new Date,t=this.customer.createTime.split(" ")[0].split("-");e.setFullYear(t[0],t[1]-1,t[2]);var a=((new Date).getTime()-e.getTime())/864e5;return a>=365?Math.floor(a/365)+"年":a>=30?Math.floor(a/30)+"个月":Math.ceil(a)+"天"}},createTime:function(){return"注册时间："+this.customer.createTime},status:function(){return"normal"===this.customer.status?"el-icon-success":"el-icon-warning"}}},A={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-row",[a("el-form-item",[a("el-input",{attrs:{placeholder:"会员名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"会员电话"},model:{value:e.queryForm.phone,callback:function(t){e.$set(e.queryForm,"phone",t)},expression:"queryForm.phone"}})],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择会员等级",clearable:""},model:{value:e.queryForm.cardLevel,callback:function(t){e.$set(e.queryForm,"cardLevel",t)},expression:"queryForm.cardLevel"}},e._l(e.levelData,function(e){return a("el-option",{key:e.level,attrs:{label:e.name,value:e.level}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:e.searchMore}},[e._v("高级搜索"),a("i",{class:e.icon})])],1)],1),e._v(" "),e.more?a("el-row",[a("el-form-item",[a("el-input",{attrs:{placeholder:"会员卡号"},model:{value:e.queryForm.cardNo,callback:function(t){e.$set(e.queryForm,"cardNo",t)},expression:"queryForm.cardNo"}})],1)],1):e._e()],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"createTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{prop:"name",label:"会员名称",width:"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"user"},[a("img",{attrs:{src:t.row.avatarUrl,width:"40",height:"40"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.name))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"电话",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardNo",label:"会员卡号",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardLevel",label:"会员等级",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"points",label:"积分",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"注册日期",width:"180",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"customer.detail",expression:"'customer.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"customer.points",expression:"'customer.points'"}],attrs:{size:"small"},on:{click:function(a){e.handlePointsHistory(t.$index,t.row)}}},[e._v("变更历史")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"customer.points",expression:"'customer.points'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.handlePoints(t.$index,t.row)}}},[e._v("调减积分")]),e._v(" "),"normal"===t.row.status?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"customer.lock",expression:"'customer.lock'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.handleLock(t.$index,t.row)}}},[e._v("锁定")]):e._e(),e._v(" "),"locked"===t.row.status?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"customer.unlock",expression:"'customer.unlock'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.handleUnlock(t.$index,t.row)}}},[e._v("解锁")]):e._e()]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","current-page":e.page,"page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"detail"==e.view?a("div",[a("div",[a("table",[a("tr",[a("td",[a("div",{staticClass:"user_avatar"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.customer.avatarUrl,expression:"customer.avatarUrl"}],staticClass:"img_avatar"})])]),e._v(" "),a("td",[a("div",[a("span",{staticClass:"display_name"},[e._v(e._s(e.customer.nickName))]),e._v(" "),a("span",{staticClass:"tips",attrs:{title:e.statuss[e.customer.status]}},[a("i",{class:e.status})])]),e._v(" "),a("div",[a("ul",{staticClass:"user_profile"},[a("li",[a("span",{staticClass:"text_gray"},[e._v("粉龄："),a("span",{staticClass:"tips",attrs:{title:e.createTime}},[e._v(e._s(e.time))])])]),e._v(" "),a("li",[a("span",{staticClass:"text_gray"},[e._v("手机号码："+e._s(e.customer.phone))])]),e._v(" "),a("li",[a("span",{staticClass:"text_gray"},[e._v("会员卡："+e._s(e.customer.cardNo))])]),e._v(" "),a("li",[a("span",{staticClass:"text_gray"},[e._v("积分："+e._s(e.customer.points))])]),e._v(" "),a("li",[a("span",{staticClass:"text_gray"},[e._v("级别："+e._s(e.customer.cardLevel))])])])])])])])]),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"history"==e.view,expression:"view =='history'"}]},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.pointsTableData,stripe:"","highlight-current-row":"","empty-text":e.pointsMessage}},[a("el-table-column",{attrs:{prop:"points",label:"变更积分数"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"变更时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"变更原因"}})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pointsPageSize,total:e.pointsTotal,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentPointsChange}})],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"调减积分",visible:e.pointsFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.pointsFormVisible=t}}},[a("el-form",{ref:"pointsForm",attrs:{model:e.pointsForm,"label-width":"80px",rules:e.pointsFormRules}},[a("el-form-item",{attrs:{label:"积分数",prop:"points"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入调整积分数"},model:{value:e.pointsForm.points,callback:function(t){e.$set(e.pointsForm,"points",t)},expression:"pointsForm.points"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"原因",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",rows:4,"auto-complete":"off",placeholder:"请输入调整积分原因"},model:{value:e.pointsForm.remark,callback:function(t){e.$set(e.pointsForm,"remark",t)},expression:"pointsForm.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.pointsFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.pointsLoading},nativeOn:{click:function(t){return e.submitPoints(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var M=a("VU/8")(O,A,!1,function(e){a("xrT9")},"data-v-3e74fb36",null).exports,K={data:()=>({queryForm:{consultantName:"",franchiserName:"",locationId:"",bespeakTimeStart:"",bespeakTimeEnd:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"id",order:"desc",message:"",listLoading:!1,locations:[],defaultProps:{value:"id",label:"locationName",children:"subLocationList"},area:[],view:"list",bespeak:{},more:!1,icon:"el-icon-arrow-down"}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},handleChange(e){e.length>0?this.queryForm.locationId=e[e.length-1]:this.queryForm.locationId=""},searchMore:function(){this.more=!this.more,this.more?this.icon="el-icon-arrow-up":this.icon="el-icon-arrow-down"},getLocationData(){this.$ajax.get("/system/location/tree").then(e=>{e.success&&e.root.subLocationList.forEach(e=>{this.locations.push(e)})})},getTableData(){let e={consultantName:this.queryForm.consultantName,franchiserName:this.queryForm.franchiserName,locationId:this.queryForm.locationId,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/bespeak/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()},handleDetail:function(e,t){this.$ajax.get("/bespeak/get/"+t.id).then(e=>{e.success?(this.bespeak=e.data,this.view="detail"):this.$message.error(e.message)})},back:function(){this.view="list"}},created(){this.getLocationData()}},H={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-row",[a("el-form-item",[a("el-input",{attrs:{placeholder:"汽车顾问姓名"},model:{value:e.queryForm.consultantName,callback:function(t){e.$set(e.queryForm,"consultantName",t)},expression:"queryForm.consultantName"}})],1),e._v(" "),a("el-form-item",[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择看车开始时间","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"00:00:00"},model:{value:e.queryForm.bespeakTimeStart,callback:function(t){e.$set(e.queryForm,"bespeakTimeStart",t)},expression:"queryForm.bespeakTimeStart"}})],1),e._v(" "),a("el-form-item",[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择看车结束时间","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"23:59:59"},model:{value:e.queryForm.bespeakTimeEnd,callback:function(t){e.$set(e.queryForm,"bespeakTimeEnd",t)},expression:"queryForm.bespeakTimeEnd"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:e.searchMore}},[e._v("高级搜索"),a("i",{class:e.icon})])],1)],1),e._v(" "),e.more?a("el-row",[a("el-form-item",[a("el-input",{attrs:{placeholder:"经销商名称"},model:{value:e.queryForm.franchiserName,callback:function(t){e.$set(e.queryForm,"franchiserName",t)},expression:"queryForm.franchiserName"}})],1),e._v(" "),a("el-form-item",[a("el-cascader",{staticStyle:{display:"block"},attrs:{placeholder:"请选择地区",options:e.locations,props:e.defaultProps,"change-on-select":"",filterable:"",clearable:""},on:{change:e.handleChange},model:{value:e.area,callback:function(t){e.area=t},expression:"area"}})],1)],1):e._e()],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"bespeakTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{prop:"customerName",label:"会员姓名",width:"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"customerPhone",label:"手机号码",width:"120","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"consultantName",label:"顾问姓名",width:"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"franchiserName",label:"经销商名称",width:"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"locationName",label:"看车地区"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.locationName.replace(new RegExp("/","gm"),"")))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"bespeakTime",label:"看车时间",width:"180",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"bespeak.detail",expression:"'bespeak.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"detail"==e.view?a("div",[a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e()])},staticRenderFns:[]};var W=a("VU/8")(K,H,!1,function(e){a("Qh82")},"data-v-9fa9c52a",null).exports,J={data:()=>({card:{},levelData:[],view:"detail",cardRules:{name:[{required:!0,message:"请输入会员卡名称",trigger:"blur"}]},editor:void 0,service:"",cardLevelForm:{},cardLevelFormRules:{level:[{required:!0,message:"请输入会员卡级别编码",trigger:"blur"}],name:[{required:!0,message:"请输入会员卡级别名称",trigger:"blur"}],points:[{required:!0,message:"请输入会员卡级别最低积分",trigger:"blur"}],color:[{required:!0,message:"请输入会员卡级别图片中字体颜色",trigger:"blur"}]},fileList:[],imageUrlList:[],dialogVisible:!1,dialogImageUrl:""}),methods:{getCardLevelData:function(){this.$ajax.get("/card/levels").then(e=>{e.success?this.levelData=e.data:this.levelData=[]})},getCardData:function(){this.$ajax.get("/card/info").then(e=>{if(void 0==this.editor){var t=this,a=window.wangEditor;this.editor=new a("#rule"),this.editor.customConfig.uploadImgServer=this.action,this.editor.customConfig.uploadImgMaxSize=10485760,this.editor.customConfig.uploadFileName="file",this.editor.customConfig.uploadImgHooks={customInsert:function(e,a,s){if(a.success){(a.data||[]).forEach(function(a){e(t.service+a)})}}},this.editor.create()}e.success?this.card=e.data:this.card={},void 0==this.card.rule&&""==this.card.rule||this.editor.txt.html(this.card.rule)})},handleCardAdd:function(){this.view="edit"},back:function(){this.view="detail"},submitCard:function(){this.editor&&(this.card.rule=this.editor.txt.html()),this.$refs.card.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/card/"+(this.card.id?"update":"add"),this.card).then(e=>{e.success?(this.$message.success("提交成功"),this.getCardData(),this.view="detail"):this.$message.error(e.message)})})})},handleCardLevelAdd:function(){this.fileList=[],this.imageUrlList=[],this.view="level",this.cardLevelForm={}},handleCardLevelUpdate:function(e){this.imageUrlList=[],this.$ajax.get("/card/level/get/"+e).then(e=>{e.success?(this.cardLevelForm=e.data,this.fileList=[],this.fileList.push({url:e.data.imageUrl}),this.view="level"):this.$message.error(e.message)})},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleCardLevelEdit:function(e){this.fileList=[],this.imageUrlList=[],this.view="level",this.cardLevelForm=this.levelData[e],this.fileList.push({url:this.cardLevelForm.imageUrl})},handleCardLevelDelete:function(e){let t=this.levelData[e];this.$confirm("确认删除"+t.name+"吗？","提示",{}).then(()=>{this.$ajax.post("/card/level/delete/"+t.id).then(e=>{e.success?(this.$message.success("删除成功"),this.getCardLevelData()):this.$message.error(e.message)})})},handleSuccess:function(e,t,a){e.success&&(this.imageUrlList=[],a.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])}))},handleRemove:function(e,t){this.imageUrlList=[],t.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])})},submitCardLevel:function(){this.imageUrlList.length>0&&(this.cardLevelForm.imageUrl=this.imageUrlList[0]),this.cardLevelForm.cardId=this.card.id,this.$refs.card.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/card/level/"+(this.cardLevelForm.id?"update":"add"),this.cardLevelForm).then(e=>{e.success?(this.$message.success("提交成功"),this.getCardLevelData(),this.view="detail"):this.$message.error(e.message)})})})}},created(){this.getCardData(),this.getCardLevelData()},mounted(){this.service=this.$imageService},computed:{action:function(){return this.service+"/file/up"}}},G={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{directives:[{name:"show",rawName:"v-show",value:"detail"==e.view,expression:"view=='detail'"}]},[e.card.id?a("div",[a("div",{staticClass:"card"},[a("div",{staticClass:"card-name"},[e._v(e._s(e.card.name)),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.update",expression:"'card.update'"}],attrs:{type:"text"},on:{click:e.handleCardAdd}},[e._v("修改>>")])],1),e._v(" "),a("div",{staticClass:"card-rule",domProps:{innerHTML:e._s(e.card.rule)}})]),e._v(" "),a("div",{staticClass:"levels"},[e._l(e.levelData,function(t,s){return[a("div",{key:s,staticClass:"level"},[a("img",{attrs:{src:t.imageUrl}}),e._v(" "),a("div",{staticClass:"name"},[e._v(e._s(t.name))]),e._v(" "),a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.level.update|card.level.delete",expression:"'card.level.update|card.level.delete'"}],staticClass:"op"},[a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.level.update",expression:"'card.level.update'"}],staticClass:"edit",on:{click:function(t){e.handleCardLevelEdit(s)}}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.level.delete",expression:"'card.level.delete'"}],staticClass:"delete",on:{click:function(t){e.handleCardLevelDelete(s)}}},[a("i",{staticClass:"el-icon-delete"})])])])]}),e._v(" "),a("div",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.level.add",expression:"'card.level.add'"}],staticClass:"level add",on:{click:e.handleCardLevelAdd}},[a("i",{staticClass:"el-icon-plus"})])],2)]):a("div",{staticClass:"no-card"},[e._v(e._s("暂无会员卡")),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"card.add",expression:"'card.add'"}],attrs:{type:"text"},on:{click:e.handleCardAdd}},[e._v("去创建>>")])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"==e.view,expression:"view=='edit'"}]},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"card",attrs:{model:e.card,"label-width":"100px",rules:e.cardRules}},[a("el-form-item",{attrs:{label:"会员卡名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.card.name,callback:function(t){e.$set(e.card,"name",t)},expression:"card.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"使用规则"}},[a("div",{attrs:{id:"rule"}})])],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitCard}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1),e._v(" "),"level"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"cardLevelForm",attrs:{model:e.cardLevelForm,"label-width":"100px",rules:e.cardLevelFormRules}},[a("el-form-item",{attrs:{label:"级别图片",required:""}},[a("el-upload",{attrs:{"list-type":"picture-card",action:e.action,"on-preview":e.handlePictureCardPreview,"file-list":e.fileList,"on-success":e.handleSuccess,"on-remove":e.handleRemove,data:{type:"image"},limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"字体颜色",prop:"color"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.cardLevelForm.color,callback:function(t){e.$set(e.cardLevelForm,"color",t)},expression:"cardLevelForm.color"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"级别编码",prop:"level"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.cardLevelForm.level,callback:function(t){e.$set(e.cardLevelForm,"level",t)},expression:"cardLevelForm.level"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"级别名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.cardLevelForm.name,callback:function(t){e.$set(e.cardLevelForm,"name",t)},expression:"cardLevelForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"最低积分",prop:"points"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.cardLevelForm.points,callback:function(t){e.$set(e.cardLevelForm,"points",t)},expression:"cardLevelForm.points"}})],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitCardLevel}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl}})])],1)},staticRenderFns:[]};var X=a("VU/8")(J,G,!1,function(e){a("kPti")},"data-v-76e42714",null).exports,Y={data:()=>({queryForm:{propertyDesc:"",propertyName:""},tableData:[],total:0,pages:0,page:1,pageSize:8,message:"",listLoading:!1,editFormVisible:!1,editLoading:!1,editFormRules:{propertyName:[{required:!0,message:"请输入参数名称",trigger:"blur"}],propertyValue:[{required:!0,message:"请输入参数值",trigger:"blur"}]},editForm:{id:"",propertyName:"",propertyValue:"",propertyDesc:""},addFormVisible:!1,addLoading:!1,addFormRules:{propertyName:[{required:!0,message:"请输入参数名称",trigger:"blur"}],propertyValue:[{required:!0,message:"请输入参数值",trigger:"blur"}]},addForm:{propertyName:"",propertyValue:"",propertyDesc:""}}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},getTableData(){let e={propertyDesc:this.queryForm.propertyDesc,propertyName:this.queryForm.propertyName,page:this.page,pageSize:this.pageSize};this.listLoading=!0,this.$ajax.get("/system/config/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleAdd:function(){this.addForm={propertyName:"",propertyValue:"",propertyDesc:""},this.addFormVisible=!0},handleEdit:function(e,t){this.editForm=Object.assign({},t),this.editFormVisible=!0},editSubmit:function(){this.$refs.editForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.editLoading=!0;let e=Object.assign({},this.editForm);this.$ajax.post("/system/config/update",e).then(e=>{this.editLoading=!1,e.success&&(this.$message({message:"提交成功",type:"success"}),this.$refs.editForm.resetFields(),this.editFormVisible=!1,this.getTableData())})})})},addSubmit:function(){this.$refs.addForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.addLoading=!0;let e=Object.assign({},this.addForm);this.$ajax.post("/system/config/add",e).then(e=>{this.addLoading=!1,e.success&&(this.$message({message:"提交成功",type:"success"}),this.$refs.addForm.resetFields(),this.addFormVisible=!1,this.getTableData())})})})},handleDel:function(e,t){this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/system/config/delete/"+t.id).then(e=>{this.listLoading=!1,e.success&&(this.$message({message:"删除成功",type:"success"}),this.getTableData())})}).catch(()=>{})}},created(){this.getTableData()}},B={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"关键字"},model:{value:e.queryForm.propertyDesc,callback:function(t){e.$set(e.queryForm,"propertyDesc",t)},expression:"queryForm.propertyDesc"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"参数名称"},model:{value:e.queryForm.propertyName,callback:function(t){e.$set(e.queryForm,"propertyName",t)},expression:"queryForm.propertyName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.config.add",expression:"'system.config.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","empty-text":e.message}},[a("el-table-column",{attrs:{type:"index",width:"60",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"propertyName",label:"参数名称",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"propertyValue",label:"参数值",width:"300","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"propertyDesc",label:"参数描述","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.config.edit",expression:"'system.config.edit'"}],attrs:{size:"small"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"system.config.delete",expression:"'system.config.delete'"}],attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"参数名称",prop:"propertyName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.propertyName,callback:function(t){e.$set(e.editForm,"propertyName",t)},expression:"editForm.propertyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"参数值",prop:"propertyValue"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.propertyValue,callback:function(t){e.$set(e.editForm,"propertyValue",t)},expression:"editForm.propertyValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"参数描述",prop:"propertyDesc"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.propertyDesc,callback:function(t){e.$set(e.editForm,"propertyDesc",t)},expression:"editForm.propertyDesc"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"参数名称",prop:"propertyName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.propertyName,callback:function(t){e.$set(e.addForm,"propertyName",t)},expression:"addForm.propertyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"参数值",prop:"propertyValue"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.propertyValue,callback:function(t){e.$set(e.addForm,"propertyValue",t)},expression:"addForm.propertyValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"参数描述",prop:"propertyDesc"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.propertyDesc,callback:function(t){e.$set(e.addForm,"propertyDesc",t)},expression:"addForm.propertyDesc"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]},Q=a("VU/8")(Y,B,!1,null,null,null).exports,Z={data:()=>({queryForm:{name:"",address:"",locationId:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"s.id",order:"desc",message:"",listLoading:!1,locations:[],defaultProps:{value:"id",label:"locationName",children:"subLocationList"},area:[],view:"list",shop:{},shopForm:{},shopFormRules:{name:[{required:!0,message:"请输入门店名称",trigger:"blur"}],code:[{required:!0,message:"请输入门店代码",trigger:"blur"}],locationId:[{required:!0,message:"请选择门店地区",trigger:"change"}],address:[{required:!0,message:"请输入门店地址",trigger:"blur"}],ll:[{required:!0,message:"请输入门店经纬度",trigger:"blur"}],radius:[{required:!0,message:"请输入门店经纬度误差半径",trigger:"blur"}]},location:[],lbs:"https://lbs.qq.com/tool/getpoint/index.html",acodeForm:{},acodeFormRules:{points:[{required:!0,message:"请输入单次扫码变动积分数",trigger:"blur"}]},service:"",showAcode:!1}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},handleChange(e){e.length>0?this.queryForm.locationId=e[e.length-1]:this.queryForm.locationId=""},handleLocationChange(e){e.length>0?this.shopForm.locationId=e[e.length-1]:this.shopForm.locationId=""},getLocationData(){this.$ajax.get("/system/location/tree").then(e=>{e.success&&e.root.subLocationList.forEach(e=>{this.locations.push(e)})})},getTableData(){let e={name:this.queryForm.name,address:this.queryForm.address,locationId:this.queryForm.locationId,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/shop/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleDelete:function(e,t){this.$confirm("确认删除"+t.name+"吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/shop/delete/"+t.id).then(e=>{this.listLoading=!1,e.success?(this.$message.success("删除成功"),this.getTableData()):this.$message.error(e.message)})}).catch(()=>{})},handleUpdate:function(e,t){this.$ajax.get("/shop/get/"+t.id).then(e=>{e.success?(this.shopForm=e.data,this.shopForm.ll=this.shopForm.latitude+","+this.shopForm.longitude,null!=e.data.locationArray?this.location=this.shopForm.locationArray:this.location=[],this.view="update"):this.$message.error(e.message)})},handleDetail:function(e,t){this.$ajax.get("/shop/get/"+t.id).then(e=>{e.success?(this.shop=e.data,this.view="detail"):this.$message.error(e.message)})},handleAcode:function(e,t){this.showAcode=!1,this.acodeForm={},this.$ajax.get("/system/config/name",{propertyName:"wx.acode.page"}).then(e=>{e.success?(this.acodeForm.page=e.data,this.acodeForm.id=t.id,this.view="acode"):this.$message.error("请先配置小程序积分码page参数")})},back:function(){this.view="list"},handleAdd:function(){this.shopForm={},this.view="add"},submitShop:function(){this.$refs.shopForm.validate(e=>{if(e){let e=this.shopForm.ll.split(",");if(2!=e.length)return void this.$message.error("经纬度格式错误");this.shopForm.latitude=e[0],this.shopForm.longitude=e[1],this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/shop/"+(this.shopForm.id?"update":"add"),this.shopForm).then(e=>{e.success?(this.$message.success("提交成功"),this.getTableData(),this.view="list"):this.$message.error(e.message)})})}})},createAcode:function(){this.$refs.acodeForm.validate(e=>{if(e){this.acodeForm.scene=this.acodeForm.id+","+this.acodeForm.points;let e=this.action+"?page="+this.acodeForm.page+"&scene="+this.acodeForm.scene;this.acodeForm.width&&(e=e+"&width="+this.acodeForm.width),this.acodeForm.src=e,this.showAcode=!0}})}},mounted(){this.service=this.$service},created(){this.getLocationData(),this.getTableData()},computed:{action:function(){return this.service+"/wx/acode"}}},ee={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"门店名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-cascader",{staticStyle:{display:"block"},attrs:{placeholder:"请选择地区",options:e.locations,props:e.defaultProps,"change-on-select":"",filterable:"",clearable:""},on:{change:e.handleChange},model:{value:e.area,callback:function(t){e.area=t},expression:"area"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"门店地址"},model:{value:e.queryForm.address,callback:function(t){e.$set(e.queryForm,"address",t)},expression:"queryForm.address"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"shop.add",expression:"'shop.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","empty-text":e.message}},[a("el-table-column",{attrs:{prop:"name",label:"门店名称",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"longitude",label:"经纬度",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.latitude)+","+e._s(t.row.longitude))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"radius",label:"误差半径(米)",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"shop.detail",expression:"'shop.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"shop.acode",expression:"'shop.acode'"}],attrs:{size:"small",type:"primary"},on:{click:function(a){e.handleAcode(t.$index,t.row)}}},[e._v("积分码")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"shop.update",expression:"'shop.update'"}],attrs:{size:"small",type:"warning"},on:{click:function(a){e.handleUpdate(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"shop.delete",expression:"'shop.delete'"}],attrs:{size:"small",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"add"==e.view||"update"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"shopForm",attrs:{model:e.shopForm,"label-width":"100px",rules:e.shopFormRules}},[a("el-form-item",{attrs:{label:"门店名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入门店名称"},model:{value:e.shopForm.name,callback:function(t){e.$set(e.shopForm,"name",t)},expression:"shopForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店代码",prop:"code"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入门店代码"},model:{value:e.shopForm.code,callback:function(t){e.$set(e.shopForm,"code",t)},expression:"shopForm.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店地区",prop:"locationId"}},[a("el-cascader",{staticStyle:{display:"block"},attrs:{placeholder:"请选择地区",options:e.locations,props:e.defaultProps,"change-on-select":"",filterable:"",clearable:""},on:{change:e.handleLocationChange},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店地址",prop:"address"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入门店地址"},model:{value:e.shopForm.address,callback:function(t){e.$set(e.shopForm,"address",t)},expression:"shopForm.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"经纬度",prop:"ll",placeholder:"纬度,经度"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.shopForm.ll,callback:function(t){e.$set(e.shopForm,"ll",t)},expression:"shopForm.ll"}},[a("template",{slot:"append"},[a("a",{staticClass:"lbs",attrs:{href:e.lbs,target:"_blank"}},[e._v("腾讯坐标拾取器")])])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"误差半径",prop:"radius"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入门店经纬度误差半径"},model:{value:e.shopForm.radius,callback:function(t){e.$set(e.shopForm,"radius",t)},expression:"shopForm.radius"}},[a("template",{slot:"append"},[e._v("米")])],2)],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitShop}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),"detail"==e.view?a("div",[a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e(),e._v(" "),"acode"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"acodeForm",attrs:{model:e.acodeForm,"label-width":"100px",rules:e.acodeFormRules}},[a("el-form-item",{attrs:{label:"积分变动值",prop:"points"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"单次扫码变动积分数，加分码为整数，减分码为负数"},model:{value:e.acodeForm.points,callback:function(t){e.$set(e.acodeForm,"points",t)},expression:"acodeForm.points"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"小程序码宽度"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"小程序码宽度，单位px，最小 280px，最大 1280px，默认 430px"},model:{value:e.acodeForm.width,callback:function(t){e.$set(e.acodeForm,"width",t)},expression:"acodeForm.width"}})],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.createAcode}},[e._v("生成积分码")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)],1)],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.showAcode},on:{"update:visible":function(t){e.showAcode=t}}},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.acodeForm.src,expression:"acodeForm.src"}],attrs:{width:"100%"}})])],1)},staticRenderFns:[]};var te=a("VU/8")(Z,ee,!1,function(e){a("S7qv")},"data-v-7e3978cc",null).exports,ae={data:()=>({queryForm:{name:"",address:"",locationId:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"id",order:"desc",message:"",listLoading:!1,locations:[],defaultProps:{value:"id",label:"locationName",children:"subLocationList"},area:[],view:"list",franchiser:{},franchiserForm:{},franchiserFormRules:{name:[{required:!0,message:"请输入经销商名称",trigger:"blur"}],locationId:[{required:!0,message:"请选择经销商地区",trigger:"change"}],address:[{required:!0,message:"请输入经销商地址",trigger:"blur"}]},location:[]}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},handleChange(e){e.length>0?this.queryForm.locationId=e[e.length-1]:this.queryForm.locationId=""},handleLocationChange(e){e.length>0?this.franchiserForm.locationId=e[e.length-1]:this.franchiserForm.locationId=""},getLocationData(){this.$ajax.get("/system/location/tree").then(e=>{e.success&&e.root.subLocationList.forEach(e=>{this.locations.push(e)})})},getTableData(){let e={name:this.queryForm.name,address:this.queryForm.address,locationId:this.queryForm.locationId,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/franchiser/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleDelete:function(e,t){this.$confirm("确认删除"+t.name+"吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/franchiser/delete/"+t.id).then(e=>{this.listLoading=!1,e.success?(this.$message.success("删除成功"),this.getTableData()):this.$message.error(e.message)})}).catch(()=>{})},handleUpdate:function(e,t){this.$ajax.get("/franchiser/get/"+t.id).then(e=>{e.success?(this.franchiserForm=e.data,null!=e.data.locationArray?this.location=this.franchiserForm.locationArray:this.location=[],this.view="update"):this.$message.error(e.message)})},handleDetail:function(e,t){this.$ajax.get("/franchiser/get/"+t.id).then(e=>{e.success?(this.franchiser=e.data,this.view="detail"):this.$message.error(e.message)})},back:function(){this.view="list"},handleAdd:function(){this.franchiserForm={},this.view="add"},submitFranchiser:function(){this.$refs.franchiserForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/franchiser/"+(this.franchiserForm.id?"update":"add"),this.franchiserForm).then(e=>{e.success?(this.$message.success("提交成功"),this.getTableData(),this.view="list"):this.$message.error(e.message)})})})}},created(){this.getLocationData(),this.getTableData()}},se={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"经销商名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-cascader",{staticStyle:{display:"block"},attrs:{placeholder:"请选择地区",options:e.locations,props:e.defaultProps,"change-on-select":"",filterable:"",clearable:""},on:{change:e.handleChange},model:{value:e.area,callback:function(t){e.area=t},expression:"area"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"经销商地址"},model:{value:e.queryForm.address,callback:function(t){e.$set(e.queryForm,"address",t)},expression:"queryForm.address"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"franchiser.add",expression:"'franchiser.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","empty-text":e.message}},[a("el-table-column",{attrs:{prop:"name",label:"经销商名称",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"locationName",label:"经销商地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.locationName.replace(new RegExp("/","gm"),""))+e._s(t.row.address))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"franchiser.detail",expression:"'franchiser.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"franchiser.update",expression:"'franchiser.update'"}],attrs:{size:"small",type:"warning"},on:{click:function(a){e.handleUpdate(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"franchiser.delete",expression:"'franchiser.delete'"}],attrs:{size:"small",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"add"==e.view||"update"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"franchiserForm",attrs:{model:e.franchiserForm,"label-width":"100px",rules:e.franchiserFormRules}},[a("el-form-item",{attrs:{label:"经销商名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入经销商名称"},model:{value:e.franchiserForm.name,callback:function(t){e.$set(e.franchiserForm,"name",t)},expression:"franchiserForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"经销商地区",prop:"locationId"}},[a("el-cascader",{staticStyle:{display:"block"},attrs:{placeholder:"请选择地区",options:e.locations,props:e.defaultProps,"change-on-select":"",filterable:"",clearable:""},on:{change:e.handleLocationChange},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"经销商地址",prop:"address"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入经销商地址"},model:{value:e.franchiserForm.address,callback:function(t){e.$set(e.franchiserForm,"address",t)},expression:"franchiserForm.address"}})],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitFranchiser}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),"detail"==e.view?a("div",[a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e()])},staticRenderFns:[]};var ie=a("VU/8")(ae,se,!1,function(e){a("ng4x")},"data-v-873de49e",null).exports,oe={data:()=>({queryForm:{name:"",phone:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"id",order:"desc",message:"",listLoading:!1,dialogVisible:!1,dialogImageUrl:"",view:"list",consultantForm:{},consultantFormRules:{name:[{required:!0,message:"请输入汽车顾问名称",trigger:"blur"}],imageUrl:[{required:!0,message:"请选择汽车顾问头像",trigger:"change"}],phone:[{required:!0,message:"请输入汽车顾问手机号码",trigger:"blur"}]},fileList:[],imageUrlList:[],service:""}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},handlePicture:function(e){this.dialogImageUrl=e,this.dialogVisible=!0},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getTableData(){let e={name:this.queryForm.name,phone:this.queryForm.phone,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/consultant/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleDelete:function(e,t){this.$confirm("确认删除"+t.name+"吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/consultant/delete/"+t.id).then(e=>{this.listLoading=!1,e.success?(this.$message.success("删除成功"),this.getTableData()):this.$message.error(e.message)})}).catch(()=>{})},handleUpdate:function(e,t){this.imageUrlList=[],this.$ajax.get("/consultant/get/"+t.id).then(e=>{e.success?(this.consultantForm=e.data,this.view="update",this.fileList=[],this.fileList.push({url:e.data.imageUrl})):this.$message.error(e.message)})},back:function(){this.view="list"},handleAdd:function(){this.fileList=[],this.imageUrlList=[],this.consultantForm={},this.view="add"},handleSuccess:function(e,t,a){e.success&&(this.imageUrlList=[],a.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])}))},handleRemove:function(e,t){this.imageUrlList=[],t.forEach(e=>{void 0===e.response?this.imageUrlList.push(e.url):this.imageUrlList.push(this.service+e.response.data[0])})},submitConsultant:function(){this.imageUrlList.length>0&&(this.consultantForm.imageUrl=this.imageUrlList[0]),this.$refs.consultantForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/consultant/"+(this.consultantForm.id?"update":"add"),this.consultantForm).then(e=>{e.success?(this.$message.success("提交成功"),this.getTableData(),this.view="list"):this.$message.error(e.message)})})})}},created(){this.getTableData()},mounted(){this.service=this.$imageService},computed:{action:function(){return this.service+"/file/up"}}},re={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"汽车顾问姓名"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"汽车顾问手机号码"},model:{value:e.queryForm.phone,callback:function(t){e.$set(e.queryForm,"phone",t)},expression:"queryForm.phone"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"consultant.add",expression:"'consultant.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","empty-text":e.message}},[a("el-table-column",{attrs:{prop:"name",label:"姓名",width:"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"imageUrl",label:"头像",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.row.imageUrl,expression:"scope.row.imageUrl"}],staticClass:"img",attrs:{width:"40",height:"40"},on:{click:function(a){e.handlePicture(t.row.imageUrl)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号码"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"consultant.update",expression:"'consultant.update'"}],attrs:{size:"small"},on:{click:function(a){e.handleUpdate(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"consultant.delete",expression:"'consultant.delete'"}],attrs:{size:"small",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"add"==e.view||"update"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"consultantForm",attrs:{model:e.consultantForm,"label-width":"100px",rules:e.consultantFormRules}},[a("el-form-item",{attrs:{label:"头像",required:""}},[a("el-upload",{attrs:{"list-type":"picture-card",action:e.action,"on-preview":e.handlePictureCardPreview,"file-list":e.fileList,"on-success":e.handleSuccess,"on-remove":e.handleRemove,data:{type:"image"},limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入汽车顾问姓名"},model:{value:e.consultantForm.name,callback:function(t){e.$set(e.consultantForm,"name",t)},expression:"consultantForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入汽车顾问手机号码"},model:{value:e.consultantForm.phone,callback:function(t){e.$set(e.consultantForm,"phone",t)},expression:"consultantForm.phone"}})],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitConsultant}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl}})])],1)},staticRenderFns:[]};var le=a("VU/8")(oe,re,!1,function(e){a("uyT9")},"data-v-34813096",null).exports,ne={data:()=>({template:{},appName:"",appIcon:"",templateData:[],pushForm:{keywords:{}},pushFormRules:{},pageData:[]}),methods:{getTemplateData:function(){this.$ajax.get("/template/page",{pageSize:20}).then(e=>{e.success?this.templateData=e.data:this.templateData=[]})},getPageData:function(){this.$ajax.get("/page/all").then(e=>{e.success?this.pageData=e.data:this.pageData=[]})},changeTemplate:function(e){this.pushForm={keywords:{}},void 0!==e&&""!==e?this.$ajax.get("/template/get/"+e).then(e=>{e.success?this.template=e.data:this.$message.error(e.message)}):this.template=[]},handleSubmit:function(){}},created(){this.$ajax.get("/system/config/name",{propertyName:"wx.name"}).then(e=>{e.success&&(this.appName=e.data)}),this.$ajax.get("/system/config/name",{propertyName:"wx.icon"}).then(e=>{e.success?this.appIcon=e.data:this.appIcon="/static/app.jpg"}),this.getTemplateData(),this.getPageData()},computed:{year:function(){return(new Date).getFullYear()},month:function(){let e=(new Date).getMonth()+1;return e>=1&&e<=9&&(e="0"+e),e}}},ce={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{staticClass:"push-box"},[a("div",{staticClass:"tmplmsg-preview"},[a("div",{staticClass:"tmplmsg-card"},[a("div",{staticClass:"tmplmsg-card-hd"},[a("div",{staticClass:"hd-cell"},[a("div",{staticClass:"app-avatar"},[a("img",{attrs:{src:e.appIcon}})]),e._v(" "),a("div",[e._v(e._s(e.appName))])])]),e._v(" "),a("div",{staticClass:"tmplmsg-card-bd"},[a("div",{staticClass:"tmplmsg-preview-title"},[e._v(e._s(e.template.title))]),e._v(" "),a("div",{staticClass:"tmplmsg-preview-desc"},[e._v(e._s(e.year)+"年"+e._s(e.month)+"月")]),e._v(" "),e.template.keywordList&&e.template.keywordList.length>0?a("div",{staticClass:"tmplmsg-preview-meta-list"},[e._l(e.template.keywordList,function(t,s){return[a("div",{key:s,staticClass:"tmplmsg-preview-meta-item"},[a("label",[e._v(e._s(t.name))]),e._v(" "),a("p",[e._v(e._s(e.pushForm.keywords[t.keyword]))])])]})],2):e._e()]),e._v(" "),e._m(0)])]),e._v(" "),a("div",{staticClass:"push-form"},[a("el-form",{ref:"pushForm",attrs:{model:e.pushForm,"label-width":"100px",rules:e.pushFormRules}},[a("el-form-item",{attrs:{label:"发送模板",prop:"name"}},[a("el-select",{attrs:{placeholder:"请选择发送模板",clearable:""},on:{change:e.changeTemplate},model:{value:e.pushForm.templateId,callback:function(t){e.$set(e.pushForm,"templateId",t)},expression:"pushForm.templateId"}},e._l(e.templateData,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}))],1),e._v(" "),e._l(e.template.keywordList,function(t){return e.template.keywordList&&e.template.keywordList.length>0?[a("el-form-item",{key:t.keyword,attrs:{label:t.name}},[a("el-input",{attrs:{type:"textarea",placeholder:t.example},model:{value:e.pushForm.keywords[t.keyword],callback:function(a){e.$set(e.pushForm.keywords,t.keyword,a)},expression:"pushForm.keywords[keyword.keyword]"}})],1)]:e._e()}),e._v(" "),e.template.keywordList&&e.template.keywordList.length>0?a("el-form-item",{attrs:{label:"放大关键字",prop:"name"}},[a("el-select",{attrs:{placeholder:"请选择放大关键字",clearable:""},model:{value:e.pushForm.emphasisKeyword,callback:function(t){e.$set(e.pushForm,"emphasisKeyword",t)},expression:"pushForm.emphasisKeyword"}},e._l(e.template.keywordList,function(e){return a("el-option",{key:e.keydata,attrs:{label:e.name,value:e.keydata}})}))],1):e._e(),e._v(" "),e.pageData.length>0?a("el-form-item",{attrs:{label:"详情页面",prop:"name"}},[a("el-select",{attrs:{placeholder:"请选择跳转详情页",clearable:""},model:{value:e.pushForm.pageId,callback:function(t){e.$set(e.pushForm,"pageId",t)},expression:"pushForm.pageId"}},e._l(e.pageData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e()],2)],1)]),e._v(" "),e.templateData.length>0?a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("提交")])],1):e._e()])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tmplmsg-card-ft"},[t("div",{staticClass:"ft-cell"},[t("span",[this._v("查看详情")]),this._v(" "),t("i",{staticClass:"el-icon-arrow-right"})])])}]};var de=a("VU/8")(ne,ce,!1,function(e){a("pGXS")},"data-v-a2f22794",null).exports,me=a("6Top"),ue={components:{draggable:a.n(me).a},data:()=>({activeName:"template",tableData:[],listLoading:!1,message:"",sort:"",order:"",syncLoading:!1,queryForm:{title:""},tableLibraryData:[],total:0,pages:0,page:1,pageSize:8,libraryMessage:"",libraryListLoading:!1,syncLibraryLoading:!1,template:{},view:"list",templateLibrary:{},libraryLoading:!1,templateLibraryKeywords:[],appName:"",appIcon:""}),methods:{handleClick:function(e,t){"library"==this.activeName&&0==this.tableLibraryData.length&&this.getTableLibraryData()},getTableData:function(){this.listLoading=!0,this.$ajax.get("/template/page",{pageSize:20,sort:this.sort,order:this.order}).then(e=>{this.listLoading=!1,e.success?this.tableData=e.data:(this.message=e.message,this.tableData=[])})},sortChanged:function(e){this.sort=e.prop,this.order="ascending"===e.order?"asc":"desc",this.getTableData()},handleDetail:function(e,t){this.$ajax.get("/template/get/"+t.id).then(e=>{e.success?(this.template=e.data,this.view="detail"):this.$message.error(e.message)}),this.appName||this.$ajax.get("/system/config/name",{propertyName:"wx.name"}).then(e=>{e.success&&(this.appName=e.data)}),this.appIcon||this.$ajax.get("/system/config/name",{propertyName:"wx.icon"}).then(e=>{e.success?this.appIcon=e.data:this.appIcon="/static/app.jpg"})},handleDelete:function(e,t){this.$confirm("确认删除"+t.title+"吗?","提示",{type:"warning"}).then(()=>{this.$ajax.post("/template/delete/"+t.id).then(e=>{e.success?(this.$message.success("删除成功"),this.getTableData()):this.$message.error(e.message)})})},handleAdd:function(){this.activeName="library",0==this.tableLibraryData.length&&this.getTableLibraryData()},handleSync:function(){this.syncLoading=!0,this.$ajax.post("/template/sync").then(e=>{this.syncLoading=!1,e.success?(this.$message.success("同步成功"),this.getTableData()):this.$message.error(e.message)})},handleSyncLibrary:function(){this.syncLibraryLoading=!0,this.$ajax.post("/template/library/sync").then(e=>{this.syncLibraryLoading=!1,this.$message.success("模板库正在同步，可能需要1分钟，请稍后再使用"),e.success?(this.$message.success("同步成功"),this.getTableLibraryData()):this.$message.error(e.message)})},handleUse:function(e,t){this.templateLibraryKeywords=[],this.libraryLoading=!0,this.$ajax.get("/template/library/get/"+t.id).then(e=>{this.libraryLoading=!1,e.success?(this.templateLibrary=e.data,this.view="use"):this.$message.error(e.message)}),this.appName||this.$ajax.get("/system/config/name",{propertyName:"wx.name"}).then(e=>{e.success&&(this.appName=e.data)}),this.appIcon||this.$ajax.get("/system/config/name",{propertyName:"wx.icon"}).then(e=>{e.success?this.appIcon=e.data:this.appIcon="/static/app.jpg"})},getTableLibraryData:function(){this.libraryListLoading=!0,this.$ajax.get("/template/library/page",{pageSize:this.pageSize,page:this.page,title:this.queryForm.title}).then(e=>{this.libraryListLoading=!1,e.success?(this.tableLibraryData=e.data,this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages):(this.tableLibraryData=[],this.page=0,this.total=0,this.pages=0,this.libraryMessage=e.message)})},handleCurrentChange(e){this.page=e,this.getTableLibraryData()},back:function(){this.view="list"},handleSubmit:function(){0==this.templateLibraryKeywords.length&&this.$message.warning("请配置关键字");let e=[];for(let t=0;t<this.templateLibraryKeywords.length;t++)e.push(this.templateLibraryKeywords[t].keyword_id);let t={id:this.templateLibrary.id,keywordList:e};this.$confirm("确认提交吗?","提示",{type:"warning"}).then(()=>{this.$ajax.post("/template/add",t).then(e=>{e.success?(this.$message.success("提交成功"),this.getTableData(),this.activeName="template",this.view="list"):this.$message.error(e.message)})})},handleCheckedKeywordsChange:function(e){if(e>0)this.templateLibraryKeywords.length>=10?(this.templateLibrary.keyword_list[e-1].checkbox=-e,this.$message.warning("最多选择10个关键词")):this.templateLibraryKeywords.push(this.templateLibrary.keyword_list[e-1]);else{let t=this.templateLibrary.keyword_list[-e-1];for(let e=0;e<this.templateLibraryKeywords.length;e++)if(this.templateLibraryKeywords[e].keyword_id==t.keyword_id){this.templateLibraryKeywords.splice(e,1);break}}},handleUnChecked:function(e){let t=this.templateLibraryKeywords[e];this.templateLibrary.keyword_list[t.checkbox-1].checkbox=-t.checkbox-1,this.templateLibraryKeywords.splice(e,1)}},computed:{year:function(){return(new Date).getFullYear()},month:function(){let e=(new Date).getMonth()+1;return e>=1&&e<=9&&(e="0"+e),e}}},pe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"我的模板",name:"template"}},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",[e._v("\n                            个人模板库\n                        ")]),e._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("span",{staticClass:"desc"},[e._v("还可添加"+e._s(25-e.tableData.length)+"个")]),e._v(" "),25-e.tableData.length>0?a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.add",expression:"'template.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加")]):e._e(),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.sync",expression:"'template.sync'"}],attrs:{type:"primary",loading:e.syncLoading},on:{click:e.handleSync}},[e._v("同步")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","default-sort":{prop:"createTime",order:"descending"},"empty-text":e.message},on:{"sort-change":e.sortChanged}},[a("el-table-column",{attrs:{prop:"title",label:"标题",width:"200","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"templateId",label:"模板ID",width:"400"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.detail",expression:"'template.detail'"}],attrs:{size:"small"},on:{click:function(a){e.handleDetail(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.delete",expression:"'template.delete'"}],attrs:{type:"warning",size:"small"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"模板库",name:"library"}},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入搜索关键字"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableLibraryData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.library.sync",expression:"'template.library.sync'"}],attrs:{type:"primary",loading:e.syncLibraryLoading},on:{click:e.handleSyncLibrary}},[e._v("同步")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.libraryListLoading,expression:"libraryListLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableLibraryData,stripe:"","highlight-current-row":"","empty-text":e.libraryMessage}},[a("el-table-column",{attrs:{prop:"templateId",label:"ID",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"同步时间",width:"180",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"template.add",expression:"'template.add'"}],attrs:{size:"small"},on:{click:function(a){e.handleUse(t.$index,t.row)}}},[e._v("选用")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"current-page":e.page,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1)],1)],1):e._e(),e._v(" "),"detail"==e.view?a("div",[a("div",{staticClass:"detail-box"},[a("div",{staticClass:"tmplmsg-preview detail-preview"},[a("div",{staticClass:"tmplmsg-card"},[a("div",{staticClass:"tmplmsg-card-hd"},[a("div",{staticClass:"hd-cell"},[a("div",{staticClass:"app-avatar"},[a("img",{attrs:{src:e.appIcon}})]),e._v(" "),a("div",[e._v(e._s(e.appName))])])]),e._v(" "),a("div",{staticClass:"tmplmsg-card-bd"},[a("div",{staticClass:"tmplmsg-preview-title"},[e._v(e._s(e.template.title))]),e._v(" "),a("div",{staticClass:"tmplmsg-preview-desc"},[e._v(e._s(e.year)+"年"+e._s(e.month)+"月")]),e._v(" "),a("div",{staticClass:"tmplmsg-preview-meta-list"},[e._l(e.template.keywordList,function(t,s){return[a("div",{key:s,staticClass:"tmplmsg-preview-meta-item"},[a("label",[e._v(e._s(t.name))]),e._v(" "),a("p",[e._v(e._s(t.example))])])]})],2)]),e._v(" "),e._m(0)])]),e._v(" "),a("div",{staticClass:"tmplmsg-detail-info"},[a("div",{staticClass:"tmplmsg-detail-info-item"},[a("label",[e._v("模板ID")]),e._v(" "),a("p",[e._v(e._s(e.template.templateId))])]),e._v(" "),a("div",{staticClass:"tmplmsg-detail-info-item"},[a("label",[e._v("标题")]),e._v(" "),a("p",[e._v(e._s(e.template.title))])]),e._v(" "),a("div",{staticClass:"tmplmsg-detail-info-item tmplmsg-detail-info-item-keyword"},[a("label",[e._v("关键词")]),e._v(" "),a("div",{staticClass:"tmplmsg-detail-info-item-keyword-list"},[e._l(e.template.keywordList,function(t,s){return[a("div",{key:s,staticClass:"tmplmsg-detail-info-item-keyword-item"},[a("label",[e._v(e._s(t.name))]),e._v(" "),a("p",[e._v(e._s("{{"+t.keydata+"}}"))])])]})],2)])])]),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e(),e._v(" "),"use"==e.view?a("div",[a("div",{staticClass:"mod-box"},[e._m(1),e._v(" "),a("div",{staticClass:"tmplmsg-box"},[a("div",{staticClass:"tmplmsg-preview"},[a("div",{staticClass:"tmplmsg-card"},[a("div",{staticClass:"tmplmsg-card-hd"},[a("div",{staticClass:"hd-cell"},[a("div",{staticClass:"app-avatar"},[a("img",{attrs:{src:e.appIcon}})]),e._v(" "),a("div",[e._v(e._s(e.appName))])])]),e._v(" "),a("div",{staticClass:"tmplmsg-card-bd"},[a("div",{staticClass:"tmplmsg-preview-title"},[e._v(e._s(e.templateLibrary.title))]),e._v(" "),a("div",{staticClass:"tmplmsg-preview-desc"},[e._v(e._s(e.year)+"年"+e._s(e.month)+"月")]),e._v(" "),a("div",{staticClass:"tmplmsg-preview-meta-list"},[e._l(e.templateLibraryKeywords,function(t,s){return[a("div",{key:s,staticClass:"tmplmsg-preview-meta-item"},[a("label",[e._v(e._s(t.name))]),e._v(" "),a("p",[e._v(e._s(t.example))])])]})],2)]),e._v(" "),e._m(2)])]),e._v(" "),a("div",{staticClass:"portable-editor"},[a("div",{staticClass:"editor-inner"},[a("div",{staticClass:"editor-inner-item"},[a("h3",[e._v("配置关键词")]),e._v(" "),a("div",{staticClass:"keywords-box"},[e._m(3),e._v(" "),a("div",{staticClass:"tmplmsg-keywords-list"},e._l(e.templateLibrary.keyword_list,function(t,s){return a("el-checkbox",{key:"keyword"+t.keyword_id,attrs:{"true-label":s+1,"false-label":-s-1},on:{change:e.handleCheckedKeywordsChange},model:{value:t.checkbox,callback:function(a){e.$set(t,"checkbox",a)},expression:"keyword.checkbox"}},[e._v(e._s(t.name))])}))])]),e._v(" "),a("div",{staticClass:"editor-inner-item"},[e._m(4),e._v(" "),a("div",{staticClass:"tmplmsg-keywords-selected-list"},[a("draggable",{model:{value:e.templateLibraryKeywords,callback:function(t){e.templateLibraryKeywords=t},expression:"templateLibraryKeywords"}},e._l(e.templateLibraryKeywords,function(t,s){return a("div",{key:"selected"+t.keyword_id,staticClass:"tmplmsg-keywords-selected-item"},[a("span",{staticClass:"el-checkbox__input is-checked",attrs:{"aria-checked":"mixed"},on:{click:function(t){e.handleUnChecked(s)}}},[a("span",{staticClass:"el-checkbox__inner"})]),e._v(" "),a("div",{staticClass:"move"},[a("div",{staticClass:"selected-item-name"},[e._v(e._s(t.name))]),e._v(" "),a("i",{staticClass:"el-icon-sort"})])])}))],1)])])])])]),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("返回")])],1)]):e._e()])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tmplmsg-card-ft"},[t("div",{staticClass:"ft-cell"},[t("span",[this._v("查看详情")]),this._v(" "),t("i",{staticClass:"el-icon-arrow-right"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"page-tips-box"},[t("p",{staticClass:"desc"},[this._v("你可用该标题的模板搭配不同的关键词使用，配置提交后关键词种类和顺序将不能修改")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tmplmsg-card-ft"},[t("div",{staticClass:"ft-cell"},[t("span",[this._v("查看详情")]),this._v(" "),t("i",{staticClass:"el-icon-arrow-right"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"attach-search"},[t("input",{attrs:{type:"text",placeholder:"请输入关键词过滤"}}),this._v(" "),t("i",{staticClass:"el-icon-search"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",[this._v("已选中的关键词"),t("p",{staticClass:"desc"},[this._v("拖拽可调整顺序")])])}]};var he=a("VU/8")(ue,pe,!1,function(e){a("lLpO")},"data-v-5588d044",null).exports,ge={data:()=>({queryForm:{name:"",code:""},tableData:[],total:0,pages:0,page:1,pageSize:8,sort:"id",order:"desc",message:"",listLoading:!1,view:"list",pageForm:{},pageFormRules:{name:[{required:!0,message:"请输入页面名称",trigger:"blur"}],code:[{required:!0,message:"请输入页面代码",trigger:"blur"}],page:[{required:!0,message:"请输入页面路径",trigger:"blur"}]}}),methods:{handleCurrentChange(e){this.page=e,this.getTableData()},getTableData(){let e={name:this.queryForm.name,code:this.queryForm.code,page:this.page,pageSize:this.pageSize,sort:this.sort,order:this.order};this.listLoading=!0,this.$ajax.get("/page/page",e).then(e=>{this.listLoading=!1,e.success?(this.page=e.page,this.pageSize=e.pageSize,this.total=e.total,this.pages=e.pages,this.tableData=e.data):(this.tableData=[],this.page=0,this.total=0,this.pages=0,this.message=e.message)})},handleDelete:function(e,t){this.$confirm("确认删除"+t.name+"吗?","提示",{type:"warning"}).then(()=>{this.listLoading=!0,this.$ajax.post("/page/delete/"+t.id).then(e=>{this.listLoading=!1,e.success?(this.$message.success("删除成功"),this.getTableData()):this.$message.error(e.message)})}).catch(()=>{})},handleUpdate:function(e,t){this.$ajax.get("/page/get/"+t.id).then(e=>{e.success?(this.pageForm=e.data,this.view="update"):this.$message.error(e.message)})},back:function(){this.view="list"},handleAdd:function(){this.pageForm={},this.view="add"},submitPage:function(){this.$refs.pageForm.validate(e=>{e&&this.$confirm("确认提交吗？","提示",{}).then(()=>{this.$ajax.post("/page/"+(this.pageForm.id?"update":"add"),this.pageForm).then(e=>{e.success?(this.$message.success("提交成功"),this.getTableData(),this.view="list"):this.$message.error(e.message)})})})}},created(){this.getTableData()}},ve={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",["list"==e.view?a("div",[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.queryForm}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"页面名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"页面编码"},model:{value:e.queryForm.code,callback:function(t){e.$set(e.queryForm,"code",t)},expression:"queryForm.code"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"page.add",expression:"'page.add'"}],attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":"","empty-text":e.message}},[a("el-table-column",{attrs:{prop:"name",label:"页面名称",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"code",label:"页面编码",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"page",label:"页面路径",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"page.update",expression:"'page.update'"}],attrs:{size:"small"},on:{click:function(a){e.handleUpdate(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"page.delete",expression:"'page.delete'"}],attrs:{size:"small",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"total, prev, pager, next","page-size":e.pageSize,total:e.total,"prev-text":"上一页","next-text":"下一页",background:""},on:{"current-change":e.handleCurrentChange}})],1)],1):e._e(),e._v(" "),"add"==e.view||"update"==e.view?a("div",[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"pageForm",attrs:{model:e.pageForm,"label-width":"100px",rules:e.pageFormRules}},[a("el-form-item",{attrs:{label:"页面名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入页面名称"},model:{value:e.pageForm.name,callback:function(t){e.$set(e.pageForm,"name",t)},expression:"pageForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"页面编码",prop:"code"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入页面编码"},model:{value:e.pageForm.code,callback:function(t){e.$set(e.pageForm,"code",t)},expression:"pageForm.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"页面路径",prop:"page"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入页面路径"},model:{value:e.pageForm.page,callback:function(t){e.$set(e.pageForm,"page",t)},expression:"pageForm.page"}})],1)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitPage}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1):e._e()])},staticRenderFns:[]};var fe=a("VU/8")(ge,ve,!1,function(e){a("NSyx")},"data-v-23725c44",null).exports;s.default.use(r.a);var be=new r.a({routes:[{path:"/",redirect:"/login",meta:{isMenu:!1}},{path:"/login",name:"login",component:c,meta:{title:"登录",isMenu:!1}},{path:"/expired",name:"expired",component:h,meta:{title:"会话过期",isMenu:!1}},{path:"/unauth",name:"unauth",component:v,meta:{title:"无权限",isMenu:!1}},{path:"/admin",redirect:"/index",meta:{title:"布局",isMenu:!1,isLogin:!0}},{path:"/home",name:"admin",redirect:"/index",component:u,meta:{title:"首页",isMenu:!0,isLeaf:!0,isLogin:!0},children:[{path:"/index",name:"index",component:y,meta:{title:"首页",isMenu:!1,isLogin:!0}}]},{path:"/system",name:"system",component:u,meta:{title:"系统管理",isMenu:!0,isLeaf:!1,permission:"system.user|system.role|system.auth|system.log|system.config|system.location"},children:[{path:"/system/user",name:"user",component:w,meta:{title:"人员管理",isMenu:!0,isLeaf:!0,permission:"system.user"}},{path:"/system/role",name:"role",component:C,meta:{title:"角色管理",isMenu:!0,isLeaf:!0,permission:"system.role"}},{path:"/system/auth",name:"auth",component:$,meta:{title:"权限管理",isMenu:!0,isLeaf:!0,permission:"system.auth"}},{path:"/system/location",name:"location",component:z,meta:{title:"地区管理",isMenu:!0,isLeaf:!0,permission:"system.location"}},{path:"/system/log",name:"log",component:T,meta:{title:"系统日志",isMenu:!0,isLeaf:!0,permission:"system.log"}},{path:"/system/config",name:"config",component:Q,meta:{title:"系统参数",isMenu:!0,isLeaf:!0,permission:"system.config"}}]},{path:"/customer",name:"customer",redirect:"/customer/index",component:u,meta:{title:"会员管理",isMenu:!0,isLeaf:!1,isLogin:!0,permission:"customer|card|bespeak"},children:[{path:"/card/index",name:"cardPage",component:X,meta:{title:"会员卡",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"card"}},{path:"/customer/index",name:"customerPage",component:M,meta:{title:"会员信息",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"customer"}},{path:"/bespeak/index",name:"bespeakPage",component:W,meta:{title:"预约看车",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"bespeak"}}]},{path:"/push",name:"push",redirect:"/push/index",component:u,meta:{title:"消息模板",isMenu:!0,isLeaf:!1,isLogin:!0,permission:"push|template|page"},children:[{path:"/push/index",name:"pushPage",component:de,meta:{title:"消息推送",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"push"}},{path:"/page/index",name:"pagePage",component:fe,meta:{title:"页面管理",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"page"}},{path:"/template/index",name:"templatePage",component:he,meta:{title:"我的模板",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"template"}}]},{path:"/carousel",name:"carousel",redirect:"/carousel/index",component:u,meta:{title:"轮播管理",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"carousel"},children:[{path:"/carousel/index",name:"carouselPage",component:E,meta:{title:"轮播管理",isMenu:!1,isLeaf:!0,permission:"carousel"}}]},{path:"/shop",name:"shop",redirect:"/shop/index",component:u,meta:{title:"门店管理",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"shop"},children:[{path:"/shop/index",name:"shopPage",component:te,meta:{title:"门店管理",isMenu:!1,isLeaf:!0,permission:"shop"}}]},{path:"/consultant",name:"consultant",redirect:"/consultant/index",component:u,meta:{title:"汽车顾问",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"consultant"},children:[{path:"/consultant/index",name:"consultantPage",component:le,meta:{title:"汽车顾问",isMenu:!1,isLeaf:!0,permission:"consultant"}}]},{path:"/franchiser",name:"franchiser",redirect:"/franchiser/index",component:u,meta:{title:"经销商",isMenu:!0,isLeaf:!0,isLogin:!0,permission:"franchiser"},children:[{path:"/franchiser/index",name:"franchiserPage",component:ie,meta:{title:"经销商",isMenu:!1,isLeaf:!0,permission:"franchiser"}}]},{path:"/setting",name:"setting",redirect:"/system/setting",component:u,meta:{title:"个人设置",isMenu:!1,isLogin:!0,permission:"system.setting"},children:[{path:"/system/setting",name:"SettingIndex",component:j,meta:{title:"个人设置",isMenu:!1,isLogin:!0}}]}]}),ye=a("zL8q"),_e=a.n(ye),Fe=(a("tvR6"),a("NYxO"));s.default.use(Fe.a);var we=new Fe.a.Store({state:{isLogin:!1,user:null,permissions:[],key:""},mutations:{login(e){e.isLogin=!0,sessionStorage.setItem("isLogin","true")},logout(e){e.isLogin=!1,e.user=null,e.permissions=[],sessionStorage.clear()},setUser(e,t){e.user=t,sessionStorage.setItem("user",JSON.stringify(t))},setPermissions(e,t){e.permissions=t,sessionStorage.setItem("permissions",JSON.stringify(t))},setKey(e,t){e.key=t,sessionStorage.setItem("key",t)}},getters:{logined:function(e){return e.isLogin||"true"==sessionStorage.getItem("isLogin")&&(e.isLogin=!0),e.isLogin},getUser:function(e){return null==e.user&&(e.user=JSON.parse(sessionStorage.getItem("user"))),e.user},getPermissions:function(e){return e.permissions==[]&&(e.permissions=JSON.parse(sessionStorage.getItem("permissions"))),e.permissions},getKey:function(e){return""==e.key&&(e.key=sessionStorage.getItem("key")),e.key}}}),ke=(a("e0XP"),a("cTzj")),xe=a.n(ke),$e=a("mtWM"),Ne=a.n($e),Le=a("wO61");function Ce(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function De(e,t,a){return a&&(a=function e(t){for(var a in t)null!==t[a]&&""!==t[a]||delete t[a],"string"===Ce(t[a])?t[a]=t[a].trim():"object"===Ce(t[a])?t[a]=e(t[a]):"array"===Ce(t[a])&&(t[a]=e(t[a]));return t}(a)),new Promise(function(s,i){Ne()({method:e,url:t,data:"POST"===e||"PUT"===e?a:null,params:"GET"===e||"DELETE"===e?a:null}).then(function(e){200===e.status?(e.data.success||("没有权限"===e.data.message?be.push({path:"/unauth"}):"没有登陆或session已过期"===e.data.message&&be.push({path:"/expired"})),s(e.data)):i(e)},function(e){Object(Le.a)({message:"网络错误，请稍后再试",type:"error"})})})}Ne.a.defaults.baseURL="https://api.shiweiinfo.com",Ne.a.defaults.timeout=12e4,Ne.a.defaults.maxRedirects=2,Ne.a.defaults.withCredentials=!0;var Se={get:function(e,t){return De("GET",e,t)},post:function(e,t){return De("POST",e,t).then(function(e){return e.success||Object(Le.a)({message:e.message,type:"error"}),Promise.resolve(e)})},serviceUrl:Ne.a.defaults.baseURL,imageServiceUrl:"https://file.ccyws.cn"},ze=a("Av7u"),Pe=a.n(ze),qe=a("4C6m"),Te=a.n(qe),Ve={random:function(e){let t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var a="";let s=0;for(;s<e;){a+=t[Math.floor(Math.random()*t.length)],s++}return a},encrypt:function(e,t){return Pe.a.enc.Base64.stringify(Pe.a.DES.encrypt(e,Pe.a.enc.Utf8.parse(t),{mode:Pe.a.mode.CBC,padding:Pe.a.pad.Pkcs7,iv:Pe.a.enc.Utf8.parse(t)}).ciphertext)},rsaEncrypt:function(e,t){let a=new Te.a;return a.setPublicKey(t),a.encrypt(e)}};s.default.use(_e.a),s.default.use(xe.a,{attempt:3,loading:"/static/loading.jpg",error:"/static/error.jpg"}),s.default.config.productionTip=!1,s.default.prototype.$ajax=Se,s.default.prototype.$service=Se.serviceUrl,s.default.prototype.$imageService=Se.imageServiceUrl,s.default.prototype.$util=Ve,s.default.directive("hasPermission",{bind:function(e,t,a){let s=JSON.parse(sessionStorage.getItem("permissions"));var i=!0;if(void 0==t.value||""==t.value)i=!1;else if(s&&s.length){var o,r=t.value.split("|");for(o in r)if(s.includes(r[o])){i=!1;break}}i&&e.parentNode.removeChild(e)}}),s.default.prototype.$contains=function(e,t){if(null==e)return!1;for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1},be.beforeEach((e,t,a)=>{e.meta.hasOwnProperty("isLogin")&&e.meta.isLogin||e.meta.hasOwnProperty("permission")?"true"==sessionStorage.isLogin?a():a("login"):a()}),new s.default({el:"#app",router:be,store:we,components:{App:o},template:"<App/>"})},NSyx:function(e,t){},NTCn:function(e,t){},Qh82:function(e,t){},S7qv:function(e,t){},UOVS:function(e,t){},azMP:function(e,t){},dSTW:function(e,t){},e0XP:function(e,t){},gCNA:function(e,t){},kH9v:function(e,t){},kPti:function(e,t){},lLpO:function(e,t){},ng4x:function(e,t){},pGXS:function(e,t){},"sAI+":function(e,t,a){"use strict";const s={success:"success",info:"info",warning:"warning",error:"error"};var i={data:()=>({visible:!1,message:"",duration:3e3,type:"info",iconClass:"",customClass:"",onClose:null,showClose:!1,closed:!1,timer:null,dangerouslyUseHTMLString:!1,center:!1}),computed:{iconWrapClass(){const e=["el-message__icon"];return this.type&&!this.iconClass&&e.push(`el-message__icon--${this.type}`),e},typeClass(){return this.type&&!this.iconClass?`el-message__icon el-icon-${s[this.type]}`:""}},watch:{closed(e){e&&(this.visible=!1,this.$el.addEventListener("transitionend",this.destroyElement))}},methods:{destroyElement(){this.$el.removeEventListener("transitionend",this.destroyElement),this.$destroy(!0),this.$el.parentNode.removeChild(this.$el)},close(){this.closed=!0,"function"==typeof this.onClose&&this.onClose(this)},clearTimer(){clearTimeout(this.timer)},startTimer(){this.duration>0&&(this.timer=setTimeout(()=>{this.closed||this.close()},this.duration))},keydown(e){27===e.keyCode&&(this.closed||this.close())}},mounted(){this.startTimer(),document.addEventListener("keydown",this.keydown)},beforeDestroy(){document.removeEventListener("keydown",this.keydown)}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"el-message-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],class:["el-message",e.type&&!e.iconClass?"el-message--"+e.type:"",e.center?"is-center":"",e.showClose?"is-closable":"",e.customClass],attrs:{role:"alert"},on:{mouseenter:e.clearTimer,mouseleave:e.startTimer}},[e.iconClass?a("i",{class:e.iconClass}):a("i",{class:e.typeClass}),e._v(" "),e._t("default",[e.dangerouslyUseHTMLString?a("p",{staticClass:"el-message__content",domProps:{innerHTML:e._s(e.message)}}):a("p",{staticClass:"el-message__content"},[e._v(e._s(e.message))])]),e._v(" "),e.showClose?a("i",{staticClass:"el-message__closeBtn el-icon-close",on:{click:e.close}}):e._e()],2)])},staticRenderFns:[]},r=a("VU/8")(i,o,!1,null,null,null);t.a=r.exports},tvR6:function(e,t){},u8my:function(e,t){},uyT9:function(e,t){},vPRW:function(e,t){},xrT9:function(e,t){},zNWp:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.249a729008c3613b29d6.js.map